<html>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap06-001.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:10 GMT -->
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Linux-UNIX-Programmierung – 6.2 Die Datei /etc/shadow</title>
<meta name="title" content="Linux-UNIX-Programmierung">
<meta name="author" content="J&uuml;rgen Wolf">
<meta name="publisher" content="Rheinwerk Verlag GmbH 2006">
<meta name="copyright" content="Rheinwerk Verlag GmbH 2006">
<meta name="description" content="Linux-UNIX-Programmierung - Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006 – ISBN 3-89842-749-8">
<meta name="audience" content="Alle">
<meta name="robots" content="INDEX,FOLLOW">
<meta http-equiv="content-language" content="de">
<link rel="stylesheet" type="text/css" href="common/rw_open.css">
<link rel="prev" href="Kap06-000.html">
<link rel="next" href="Kap06-002.html"><script type="text/javascript" language="JavaScript"><!--
function OpenWin(url,name,height,width)
{
  var InfoWin = window.open(url,name,"directories=0,height="+height+",width=" + width + ",hotkeys=0,location=0,menubar=0,resizable=1,screenX=150,screenY=10,left=150,top=10,scrollbars=1,status=1,titlebar=0,toolbar=0");
  InfoWin.focus();
}
//--></script></head>
<body vlink="#000099" link="#000099" alink="#000099">
<table width="100%" height="74" border="0" cellpadding="0" cellspacing="0" bgcolor="#00549d">
<tr>
<td height="74" valign="bottom" colspan="2"><a href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"><img src="common/rw_openbook.gif" width="200" height="56" border="0" alt="Rheinwerk Computing < openbook >"></a></td>
<td width="80" height="74">
<a href="https://www.rheinwerk-verlag.de/?GPP=oplup"><img src="common/rw_computing.gif" border="0" alt="Rheinwerk Computing - Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger."></a>
</td>
</tr>
</table><div align="right"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger</a></div><br /><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="156" valign="top"><table border="0" cellpadding="0" cellspacing="0" width="100%" align="left">
<tr>
<td colspan="2" class="nav1" align="left" valign="top" height="150">
<table class="tbl1" width="150" border="0" cellpadding="3" cellspacing="0">
<tr>
<td class="tbl2" height="25"><A class="nav" href="index-2.html">Inhaltsverzeichnis</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00a-000.html#Xxx999195">Vorwort des Autors</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00b-000.html#Xxx999195">Vorwort der Fachgutachter</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap01-000.html#Xxx999235">1 Einf&uuml;hrung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap02-000.html#Xxx999234">2 E/A-Funktionen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap03-000.html#Xxx999234">3 Attribute von Dateien und Verzeichnissen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap04-000.html#Xxx999234">4 Zugriff auf Systeminformationen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap05-000.html#Xxx999234">5 Devices – eine einfache Verbindung zur Hardware</A></td>
</tr>
<tr>
<td><A class="navnavh" href="Kap06-000.html#Xxx999234">6 System- und Benutzerdateien</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap07-000.html#Xxx999234">7 D&auml;monen, Zombies und Prozesse</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap08-000.html#Xxx999235">8 Signale</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap09-000.html#Xxx999235">9 IPC – Interprozesskommunikation</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap10-000.html#Xxx999234">10 Threads</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap11-000.html#Xxx999235">11 Netzwerkprogrammierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap12-000.html#Xxx999236">12 MySQL und PostgreSQL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap13-000.html#Xxx999235">13 Terminal E/A und Benutzerschnittstellen f&uuml;r die Konsole</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap14-000.html#Xxx999235">14 Xlib – X Window-Programmierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap15-000.html#Xxx999235">15 GTK+</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap16-000.html#Xxx999235">16 SDL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap17-000.html#Xxx999247">17 Werkzeuge f&uuml;r Programmierer</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18A-000.html#Xxx999248">A Sicherheit unter Linux</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18B-000.html#Xxx999245">B Funktionsreferenz</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18C-000.html#Xxx999245">C Inhalt der Buch-CD</A></td>
</tr>
<tr>
<td><A class="navnav" href="stichwort.html#Xxx537584">Index</A></td>
</tr>
<tr><td><br /><!--<a class="navnav" href="http://download.galileo-press.de/openbook/lup/galileocomputing_linux_unix_programmierung.zip"><strong>Download:</strong><br />- ZIP, ca. 4,3 MB</a></td></tr>
<tr><td><a class="navnav" href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup">Buch bestellen</a></td></tr>
<tr><td>--><a class="navnav" href="https://www.rheinwerk-verlag.de/feedback/">Ihre Meinung?</a><br /><br /></td></tr>
</table></td>
</tr>

</table>
</td>
<td width="10"><img src="common/spacer10.gif" width="10" height="10"></td>
<td width="85%" valign="top" align="center">
<div align="center">
<table width="98%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap06-000.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Rheinwerk Computing /</a><a class="navnav" href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"> &lt;openbook&gt; /</a> <a href="index-2.html" class="navnav"> Linux-UNIX-Programmierung</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap06-002.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" valign="top">
<table width="100%" border="0" cellpadding="10" cellspacing="0" class="box">
<tr>
<td colspan="2"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup" class="buchtitel">Linux-UNIX-Programmierung</a><span class="autor"> von J&uuml;rgen Wolf</span><br><span class="untertitel">Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006</span></td>
</tr>
<tr>
<td valign="top" width="90"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup"><img src="common/9783898427494.gif" border="0" alt="Buch: Linux-UNIX-Programmierung" title="Buch: Linux-UNIX-Programmierung" align="left"><br /><br /><span class="autor"><strong>Linux-UNIX-Programmierung</strong><br />1216 S., mit CD, 49,90 Euro<br />Rheinwerk Computing<br />ISBN 3-89842-749-8</span></a></a></td>
<td width="80%">
<table border="0">
<tr>
<td valign="baseline"><img src="common/pfeil_u.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="3" class="kap"><b>Kapitel <a href="Kap06-000.html#RxxKap060000400019A1F029100">6 System- und Benutzerdateien</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap06-000.html#RxxKap060000400019A1F029102">6.1 Die Datei /etc/passwd</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-000.html#RxxKap060000400019A1F029111">6.1.1 Die Datei /etc/passwd auswerten</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-000.html#RxxKap060000400019A1F029182">6.1.2 getpwuid und getpwnam – einzelne Abfrage von /etc/passwd</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-000.html#RxxKap060000400019A1F02918E">6.1.3 getpwent, setpwent und endpwent – komplette Abfrage von /etc/passwd</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a class="navh2" href="#RxxKap06001040001B71F04E100">6.2 Die Datei /etc/shadow</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap06001040001B71F04E110">6.2.1 Die Datei /etc/shadow auswerten</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap06001040001B71F04E185">6.2.2 getspent, setspent und endspent – komplette Abfrage von /etc/shadow</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap06-002.html#RxxKap06002040001B81F02D100">6.3 Die Datei /etc/group</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-002.html#RxxKap06002040001B81F02D10C">6.3.1 Die Datei /etc/group auswerten</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-002.html#RxxKap06002040001B81F02D177">6.3.2 getgrnam und getgrgid – einzelne Eintr&auml;ge aus /etc/group abfragen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap06-002.html#RxxKap06002040001B81F02D182">6.3.3 getgrent, setgrent und endgrent – alle Eintr&auml;ge in /etc/group abfragen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap06-003.html#RxxKap06003040001B91F042100">6.4 uname – Informationen zum lokalen System erfragen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap06-004.html#RxxKap06004040001BA1F013100">6.5 Das Verzeichnis /etc/skel und Network Information Service (NIS)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap06-005.html#RxxKap06005040001BB1F010100">6.6 Dateien f&uuml;r Netzwerkinformationen</a></b></td>
</tr>
</table><br></td>
</tr>
</table>
<table width="100%" cellpadding="20" cellspacing="0" border="0" bgcolor="#eeeeee">
<tr>
<td>
<a name="t21"></a><a name="t2t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div>
<h2 class="t2">6.2 <a id="RxxKap0642DieDateietcshadow" name="RxxKap0642DieDateietcshadow"></a>Die Datei /etc/shado<a id="RxxKap06001040001B71F04E100" name="RxxKap06001040001B71F04E100"></a>w 
      <a href="#t2t32"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"></h2>
<p><a id="Xxx999235" name="Xxx999235"></a><a id="Xxx999236" name="Xxx999236"></a>Wie bereits erw&auml;hnt, speicherten &auml;ltere Linux-/UNIX-Versionen die Passw&ouml;rter noch direkt in der Datei /etc/passwd im zweiten Feld. Hatte ein Anwender Zugriff auf diese Datei, wurde h&auml;ufig ein so genannter W&ouml;rterbuchangriff gemacht, um dieses Passwort zu entschl&uuml;sseln. Hierzu wurde dazumal das Kommando <span class="listing">crypt</span> zum Entschl&uuml;sseln verwendet. Hatte der Anwender dabei ein einfaches Passwort aus Buchstaben verwendet, war es in der Tat m&ouml;glich, das Passwort zu knacken. Hierauf soll aber nicht n&auml;her eingegangen werden.</p>
<p>Fakt ist, dass eben eine Angriffsfl&auml;che vorhanden war, die mit der Passwortdatei /etc/shadow beseitigt wurde. Da der Eigent&uuml;mer und die Gruppe dieser Datei root ist, ist diese auch nicht mehr zum Lesen zu &ouml;ffnen. Der Eintrag in die Datei erfolgt nach demselben Schema wie schon in der Datei /etc/passwd. Ein Eintrag steht jeweils in einer Zeile, und die einzelnen Felder wiederum werden durch einen Doppelpunkt getrennt. Die Syntax:</p>
<pre>Name:Pass:DOC:MinTag:MaxTag:Warn:DeaktivIn:DeaktivSeit:Frei</pre>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Name – Der Benutzername, der im ersten Feld steht, verkn&uuml;pft diesen Eintrag mit einem gleichnamigen Eintrag in der Datei /etc/passwd. Somit sollten f&uuml;r alle Eintr&auml;ge in der Datei /etc/passwd auch Eintr&auml;ge in der Datei /etc/shadow existieren.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Pass – Hier steht das verschl&uuml;sselte Passwort des Benutzers. Befindet sich hier ein »*« oder »!«, bedeutet dies, dass kein Passwort eingetragen ist – was aus Gr&uuml;nden der Datensicherheit vermieden werden sollte.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> DOC (Day of last change) – Hier steht der Tag, an dem das Datum seit dem 1.1.1970 ver&auml;ndert wurde. Dieser Tag (eine Integer-Zahl) wird zur &Uuml;berpr&uuml;fung der Lebensdauer von Passw&ouml;rtern verwendet.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> MinTag – Der fr&uuml;hestm&ouml;gliche Zeitpunkt (in Tagen), wann der Benutzer sein Passwort &auml;ndern kann.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> MaxTag – Der sp&auml;tm&ouml;glichste Termin (in Tagen), wann der Benutzer sein Passwort &auml;ndern muss.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Warn – Hier wird eingetragen, wie viele Tage vor Ablauf des Passwortes (siehe »MaxTage«) der Benutzer eine Warnung bei der Anmeldung auf dem Bildschirm angezeigt bekommt.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Deaktiv – Hier wird eingetragen, wie viele Tag das Passwort nach Ablauf von »MaxTage« noch g&uuml;lig ist. Danach kann sich der Benutzer nicht mehr anmelden.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> DeaktivSeit – Hier findet man die Anzahl von Tagen, seit ein Passwort gesperrt wurde (deaktiv ist).</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Frei – Ein freies Feld f&uuml;r eventuell sp&auml;tere Erweiterungen. Hat jetzt noch keine Bedeutung.</td>
</tr>
</table>
<p>Hierzu ein einfaches Beispiel aus meiner /etc/shadow-Datei:</p>
<pre>john:$1$oLLnoOfp$MQch.ycZRIzUZ0JYnaXRB/:12952:0:99999:7:::</pre>
<p>Der Benutzer hei&szlig;t hier »john«, das verschl&uuml;sselte Passwort lautet »$1$oLLnoOfp$MQch.ycZRIzUZ0JYnaXRB/«, das Passwort wurde am 12952. Tag nach 1.1.1970 das letzte Mal ver&auml;ndert und kann fr&uuml;hestens in 0 Tagen (also heute) und muss sp&auml;testens in 99999 Tagen (ca. 274 Jahren) ge&auml;ndert werden – in dem Fall also immer. 14 Tage (sofern Sie diesen Tag &uuml;berleben) vor Ablauf des Passwortes soll eine Warnung ausgegeben werden. Die anderen Werte wurden vom Administrator nicht definiert und sind leer.</p>
<a name="t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t32"></a><h3 class="t3">6.2.1 Die Datei /etc/shadow auswerten<a id="RxxKap06001040001B71F04E110" name="RxxKap06001040001B71F04E110"></a> 
      <a href="#t2t33"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t31"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999253" name="Xxx999253"></a><a id="Xxx999254" name="Xxx999254"></a>Die einzelnen Felder der Datei /etc/shadow sind in der Struktur struct spwd enthalten und in der Headerdatei &lt;shadow.h&gt; definiert.</p>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<caption class="tabunter">
<p><span class="tabunter"><b>Tabelle 6.2   
    </b>Die Struktur spwd in der Headerdatei &lt;shadow.h&gt;</span></p>
</caption>
<tr>
<td class="tabellenkopf" bgcolor="#000000"><b>Strukturvariable</b>
</td>
<td class="tabellenkopf" bgcolor="#000000"><b>Bedeutung</b>
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">char *sp_namp
</td>
<td class="tabellentext" bgcolor="#000000">Benutzername (Loginname)
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">char *sp_pwdp
</td>
<td class="tabellentext" bgcolor="#000000">Verschl&uuml;sseltes Passwort
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_lstchg
</td>
<td class="tabellentext" bgcolor="#000000">Datum der letzten &Auml;nderung (seit dem 1.1.1970)
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_min
</td>
<td class="tabellentext" bgcolor="#000000">N&auml;chste &Auml;nderung fr&uuml;hestens m&ouml;glich in sp_min Tagen
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_max
</td>
<td class="tabellentext" bgcolor="#000000">Sp&auml;testens muss eine &Auml;nderung gemacht werden in sp_max Tagen.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_warn
</td>
<td class="tabellentext" bgcolor="#000000">Anzahl Tage, die der Benutzer gewarnt werden soll, bevor das Passwort abl&auml;uft. 
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_inact  
</td>
<td class="tabellentext" bgcolor="#000000">Anzahl nach sp_max, wenn der Account deaktiviert wird
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">long int sp_expire  
</td>
<td class="tabellentext" bgcolor="#000000">Anzahl Tage nach dem 1.1.1970, seit der Account deaktiviert bzw. gesperrt wurde
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">unsigned long int sp_flag
</td>
<td class="tabellentext" bgcolor="#000000">Wird noch nicht verwendet.
</td>
</tr>
</table><br>
<a name="t32"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t33"></a><h3 class="t3">6.2.2 getspent, setspent und endspent – komplette Abfrage von 
/etc/shado<a id="RxxKap06001040001B71F04E185" name="RxxKap06001040001B71F04E185"></a>w 
      <img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"><a href="#t2t32"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999306" name="Xxx999306"></a><a id="Xxx999307" name="Xxx999307"></a><a id="Xxx999308" name="Xxx999308"></a>Wie auch schon bei der Datei /etc/passwd stehen Ihnen bei der Datei /etc/shadow entsprechende Funktionen zur Verf&uuml;gung, wo Sie alle Daten in /etc/shadow erfragen k&ouml;nnen.</p>
<pre>#include &lt;shadow.h&gt;
struct spwd *getspent(void);
void setspent(void);
void endspent(void);</pre>
<p>Die Funktion <span class="listing">getspent()</span> liefert einen Zeiger auf die Struktur <span class="listing">spwd</span> zur&uuml;ck, die den Inhalt einer Zeile in /etc/shadow beinhaltet. Auch hier wird beim ersten Aufruf immer der erste Eintrag der Datei /etc/shadow zur&uuml;ckgeliefert. Jeder weitere Aufruf von <span class="listing">getspent()</span> holt sich immer die n&auml;chste Zeile der Datei /etc/shadow. Nach jedem Aufruf von <span class="listing">getspent()</span> wird der alte Inhalt in der Struktur von neuem &uuml;berschrieben. Der R&uuml;ckgabewert ist bei einem Fehler oder dem Ende der Datei /etc/shadow <span class="listing">NULL</span>.</p>
<p>Wollen Sie sichergehen, dass <span class="listing">getspent()</span> wirklich vom Anfang der Datei /etc/shadow beginnt, m&uuml;ssen Sie die Funktion <span class="listing">setspent()</span> aufrufen. Hiermit wird der Lesezeiger auf den Anfang der Datei /etc/shadow gesetzt.</p>
<p>Wenn Sie mit <span class="listing">getspent()</span> fertig sind, k&ouml;nnen Sie mit <span class="listing">endspent()</span> die Datei /etc/shadow wieder schlie&szlig;en. Dies garantiert Ihnen bei einem erneuten Aufruf von <span class="listing">getspent()</span>, dass /etc/shadow wieder neu ge&ouml;ffnet wird und sich der Dateizeiger am Anfang dieser Datei befindet.</p>
<p>Hierzu ein einfaches Beispiel von <span class="listing">getspent()</span> und <span class="listing">endspent()</span>. Sie geben &uuml;ber der Kommandozeile einen entsprechenden Benutzer ein, wovon Sie die Passwortinformationen aus der /etc/shadow-Datei ermitteln k&ouml;nnen. Da /etc/shadow eine Datei ist, die nur vom Benutzer und der Gruppe root gelesen werden kann, ben&ouml;tigen Sie f&uuml;r dieses Programm auch die entsprechende Superuser-Rechte.</p>
<pre>/* read_shadow.c */
/* Programm ben&ouml;tigt Superuser-Rechte  */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;shadow.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
struct spwd *getshadow(const char *loginname) {
   struct spwd *shadow_ptr;
   while( shadow_ptr=getspent() ) {
      if( strcmp(shadow_ptr-&gt;sp_namp, loginname) == 0) {
         endspent();
         return shadow_ptr;
      }
   }
   endspent();
   return NULL;
}
int main(int argc, char *argv[]) {
   struct spwd *shadow_ptr;
   if( argc != 2 ) {
      fprintf(stderr, "Usage: %s Name\n", argv[0]);
      exit (EXIT_FAILURE);
   }
   shadow_ptr=getshadow(argv[1]);
   if(shadow_ptr == NULL) {
      printf("Konnte nichts &uuml;ber %s ermitteln\n", argv[1]);
      exit (EXIT_FAILURE);
   }
   printf("Folgendes wurde zu %s ermittelt: \n", argv[1]);
   printf("Benutzername              : %s\n",
      shadow_ptr-&gt;sp_namp);
   printf("Passwort (verschl&uuml;sselt)   : %d\n", 
      shadow_ptr-&gt;sp_pwdp);
   printf("Tag der letzten &Auml;nderung  : %li Tage\n",
      shadow_ptr-&gt;sp_lstchg);
   printf("N&auml;chste &Auml;nderung m&ouml;glich  : %li Tage\n", 
      shadow_ptr-&gt;sp_min);
   printf("N&auml;chste &Auml;nderung f&auml;llig   : %li Tage\n", 
      shadow_ptr-&gt;sp_max);
   printf("Warnung, wenn Passwort f&auml;llig %li Tage zuvor!\n", 
      shadow_ptr-&gt;sp_warn);
   printf("Konto nach %li Tagen vor Ablauf der Frist sperren!\n", 
      shadow_ptr-&gt;sp_inact);
   return EXIT_SUCCESS;
}</pre>
<p>Das Programm bei der Ausf&uuml;hrung:</p>
<pre>you@host &gt; sudo ./read_shadow tot
Passwort:*******
Folgendes wurde zu tot ermittelt:
Benutzername              : tot
Passwort (verschl&uuml;sselt)   : 134520844
Tag der letzten &Auml;nderung  : 12928 Tage
N&auml;chste &Auml;nderung m&ouml;glich  : 0 Tage
N&auml;chste &Auml;nderung f&auml;llig   : 99999 Tage
Warnung, wenn Passwort f&auml;llig 7 Tage zuvor!
Konto nach -1 Tagen vor Ablauf der Frist sperren!</pre>
<p>Eine Ausgabe von -1 wie in der letzten Zeile zeigt an, dass dieser Wert nicht verwendet wird.</p>
<p>Nat&uuml;rlich gibt es auch eine entsprechende Funktion wie <span class="listing">getpwnam()</span> bei /etc/passwd f&uuml;r /etc/shadow mit <span class="listing">getspnam()</span>. Die Syntax:<a id="Xxx999320" name="Xxx999320"></a></p>
<pre>#include &lt;shadow.h&gt;
struct spwd *getspnam(const char *name);</pre>
<p>Die Funktion <span class="listing">getspnam()</span> gibt ebenfalls einen Zeiger auf eine Struktur <span class="listing">spwd</span> zur&uuml;ck, die den Inhalt einer Zeile in /etc/shadow mit dem Benutzernamen <span class="listing">name</span> enth&auml;lt. Ansonsten bei einem Fehler oder wenn der Name nicht gefunden werden konnte, gibt diese Funktion <span class="listing">NULL</span> zur&uuml;ck. Hierzu das Beispiel zu <span class="listing">getspnam()</span>:</p>
<pre>/* read_shadow2.c */
/* Programm ben&ouml;tigt Superuser-Rechte  */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;shadow.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
int main(int argc, char *argv[]) {
   struct spwd *shadow_ptr;
   if( argc != 2 ) {
      fprintf(stderr, "Usage: %s Name\n", argv[0]);
      exit (EXIT_FAILURE);
   }
   shadow_ptr=getspnam(argv[1]);
   if(shadow_ptr == NULL) {
      printf("Konnte nichts &uuml;ber %s ermitteln\n", argv[1]);
      exit (EXIT_FAILURE);
   }
   printf("Folgendes wurde zu %s ermittelt: \n", argv[1]);
   printf("Benutzername              : %s\n",
      shadow_ptr-&gt;sp_namp);
   printf("Passwort (verschl&uuml;sselt)   : %d\n",
      shadow_ptr-&gt;sp_pwdp);
   printf("Tag der letzten &Auml;nderung  : %li Tage\n", 
      shadow_ptr-&gt;sp_lstchg);
   printf("N&auml;chste &Auml;nderung m&ouml;glich  : %li Tage\n", 
      shadow_ptr-&gt;sp_min);
   printf("N&auml;chste &Auml;nderung f&auml;llig   : %li Tage\n", 
      shadow_ptr-&gt;sp_max);
   printf("Warnung, wenn Passwort f&auml;llig %li Tage zuvor!\n", 
      shadow_ptr-&gt;sp_warn);
   printf("Konto nach %li Tagen vor Ablauf der Frist sperren!\n", 
      shadow_ptr-&gt;sp_inact);
   return EXIT_SUCCESS;
}</pre>
<p>Bei der Ausf&uuml;hrung entspricht das Programme exakt dem von »read_shadow.c«. Nat&uuml;rlich ben&ouml;tigen Sie auch hierzu wieder die Superuser-Rechte, um die Datei /etc/shadow lesen zu k&ouml;nnen.</p>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<tr>
<td class="tabellentext" bgcolor="#000000">
<p class="BStandard"><b>Hinweis   </b>Neben den hier vorgestellten Funktionen bietet die <span class="listing">&lt;shadow.h</span> <span class="listing">&gt;</span>-API noch einige Funktionen mehr an. Ein Aufruf von z. B. »man getspent« bringt die weiteren Routinen zum Vorschein.</p>
</td>
</tr>
</table><br>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap06-000.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a class="navnav" href="#">&lt;top&gt;</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap06-002.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
</td>
<td width="10" valign="top">&nbsp;&nbsp;</td>
<td width="160" valign="top">
    <table border="0" cellpadding="0" cellspacing="0" width="160">
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">
                            &nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs">
                            <strong>Zum Katalog</strong></a>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2">
                            <img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><a href="https://www.rheinwerk-verlag.de/linux-unix-programmierung_1137/?GPP=oplup">
                                        <img src="common/749.gif"  border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-UNIX-Programmierung" title="Zum Katalog: Linux-UNIX-Programmierung">
                                        <br /><strong>Linux-UNIX-<br />Programmierung</strong><br /><img src="common/pfeil_rechts5.gif" border="0" alt="">bestellen</a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Ihre Meinung?</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td>Wie hat Ihnen das &lt;openbook&gt; gefallen?<br /><a href="https://www.rheinwerk-verlag.de/feedback/"><img src="common/pfeil_rechts5.gif" border="0" alt="">Ihre Meinung</a>
                                    <br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">&nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs"><strong>Buchtipps</strong></a></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-server_3685/?GPP=oplup">
                        <img src="common/3020.gif" width="78" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Server" title="Zum Katalog: Linux-Server"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-Server</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/das-komplettpaket-lpic-1-lpic-2_3782/?GPP=oplup">
                        <img src="common/3529.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2" title="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2"><br /><br /><br /><br /><br /><br /><br />&nbsp;Das Komplettpaket<br />&nbsp;LPIC-1 &amp; LPIC-2</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-hochverfugbarkeit_3420/?GPP=oplup">
                        <img src="common/2542.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Hochverfügbarkeit" title="Zum Katalog: Linux-Hochverfügbarkeit"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-<br />&nbsp;Hochverfügbarkeit</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/shell-programmierung_3345/?GPP=oplup">
                        <img src="common/2310.gif" width="69" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Shell-Programmierung" title="Zum Katalog: Shell-Programmierung"><br /><br /><br /><br /><br /><br /><br />&nbsp;Shell-<br />&nbsp;Programmierung</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux_3436/?GPP=oplup">
                        <img src="common/2591.gif" width="79" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux Handbuch" title="Zum Katalog: Linux Handbuch"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux Handbuch</a><br /><br /></td>
                    </tr>
                </table></td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Shopping</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><b>Versandkostenfrei</b> bestellen in Deutschland und &Ouml;sterreich<br /><a href="https://www.rheinwerk-verlag.de/hilfe/bestellung_6?GPP=oplup"><img src="common/pfeil_rechts5.gif" border="0" alt="">Info</a><br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</td>
</tr>
</table>
<br /><br />
<hr width="70%" align="center">
<br />
<div align="center">
    <p class="standard">
        <strong>Copyright © Rheinwerk Verlag GmbH 2006</strong>
        <br />F&uuml;r Ihren privaten Gebrauch d&uuml;rfen Sie die Online-Version nat&uuml;rlich 
        ausdrucken. Ansonsten unterliegt das &lt;openbook&gt; denselben Bestimmungen, 
        wie die gebundene Ausgabe: Das Werk einschlie&szlig;lich aller seiner Teile ist 
        urheberrechtlich gesch&uuml;tzt. Alle Rechte vorbehalten einschlie&szlig;lich der 
        Vervielf&auml;ltigung, &Uuml;bersetzung, Mikroverfilmung sowie Einspeicherung und 
        Verarbeitung in elektronischen Systemen.
    </p>
    <br><a href="https://www.rheinwerk-verlag.de/">[Rheinwerk Computing]</a>
    <br /><br />Rheinwerk Verlag GmbH, Rheinwerkallee 4, 53227 Bonn, 
    Tel.: 0228.42150.0, Fax 0228.42150.77, 
    <a href="mailto:service@rheinwerk-verlag.de">service@rheinwerk-verlag.de</a>
</div>
<br /><br />
</body>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap06-001.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:10 GMT -->
</html>
