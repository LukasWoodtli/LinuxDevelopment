<html>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap04-003.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:10 GMT -->
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Linux-UNIX-Programmierung – 4.4 Kernel-Informationen</title>
<meta name="title" content="Linux-UNIX-Programmierung">
<meta name="author" content="J&uuml;rgen Wolf">
<meta name="publisher" content="Rheinwerk Verlag GmbH 2006">
<meta name="copyright" content="Rheinwerk Verlag GmbH 2006">
<meta name="description" content="Linux-UNIX-Programmierung - Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006 – ISBN 3-89842-749-8">
<meta name="audience" content="Alle">
<meta name="robots" content="INDEX,FOLLOW">
<meta http-equiv="content-language" content="de">
<link rel="stylesheet" type="text/css" href="common/rw_open.css">
<link rel="prev" href="Kap04-002.html">
<link rel="next" href="Kap04-004.html"><script type="text/javascript" language="JavaScript"><!--
function OpenWin(url,name,height,width)
{
  var InfoWin = window.open(url,name,"directories=0,height="+height+",width=" + width + ",hotkeys=0,location=0,menubar=0,resizable=1,screenX=150,screenY=10,left=150,top=10,scrollbars=1,status=1,titlebar=0,toolbar=0");
  InfoWin.focus();
}
//--></script></head>
<body vlink="#000099" link="#000099" alink="#000099">
<table width="100%" height="74" border="0" cellpadding="0" cellspacing="0" bgcolor="#00549d">
<tr>
<td height="74" valign="bottom" colspan="2"><a href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"><img src="common/rw_openbook.gif" width="200" height="56" border="0" alt="Rheinwerk Computing < openbook >"></a></td>
<td width="80" height="74">
<a href="https://www.rheinwerk-verlag.de/?GPP=oplup"><img src="common/rw_computing.gif" border="0" alt="Rheinwerk Computing - Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger."></a>
</td>
</tr>
</table><div align="right"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger</a></div><br /><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="156" valign="top"><table border="0" cellpadding="0" cellspacing="0" width="100%" align="left">
<tr>
<td colspan="2" class="nav1" align="left" valign="top" height="150">
<table class="tbl1" width="150" border="0" cellpadding="3" cellspacing="0">
<tr>
<td class="tbl2" height="25"><A class="nav" href="index-2.html">Inhaltsverzeichnis</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00a-000.html#Xxx999195">Vorwort des Autors</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00b-000.html#Xxx999195">Vorwort der Fachgutachter</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap01-000.html#Xxx999235">1 Einf&uuml;hrung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap02-000.html#Xxx999234">2 E/A-Funktionen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap03-000.html#Xxx999234">3 Attribute von Dateien und Verzeichnissen</A></td>
</tr>
<tr>
<td><A class="navnavh" href="Kap04-000.html#Xxx999234">4 Zugriff auf Systeminformationen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap05-000.html#Xxx999234">5 Devices – eine einfache Verbindung zur Hardware</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap06-000.html#Xxx999234">6 System- und Benutzerdateien</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap07-000.html#Xxx999234">7 D&auml;monen, Zombies und Prozesse</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap08-000.html#Xxx999235">8 Signale</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap09-000.html#Xxx999235">9 IPC – Interprozesskommunikation</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap10-000.html#Xxx999234">10 Threads</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap11-000.html#Xxx999235">11 Netzwerkprogrammierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap12-000.html#Xxx999236">12 MySQL und PostgreSQL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap13-000.html#Xxx999235">13 Terminal E/A und Benutzerschnittstellen f&uuml;r die Konsole</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap14-000.html#Xxx999235">14 Xlib – X Window-Programmierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap15-000.html#Xxx999235">15 GTK+</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap16-000.html#Xxx999235">16 SDL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap17-000.html#Xxx999247">17 Werkzeuge f&uuml;r Programmierer</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18A-000.html#Xxx999248">A Sicherheit unter Linux</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18B-000.html#Xxx999245">B Funktionsreferenz</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18C-000.html#Xxx999245">C Inhalt der Buch-CD</A></td>
</tr>
<tr>
<td><A class="navnav" href="stichwort.html#Xxx537584">Index</A></td>
</tr>
<tr><td><br /><!--<a class="navnav" href="http://download.galileo-press.de/openbook/lup/galileocomputing_linux_unix_programmierung.zip"><strong>Download:</strong><br />- ZIP, ca. 4,3 MB</a></td></tr>
<tr><td><a class="navnav" href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup">Buch bestellen</a></td></tr>
<tr><td>--><a class="navnav" href="https://www.rheinwerk-verlag.de/feedback/">Ihre Meinung?</a><br /><br /></td></tr>
</table></td>
</tr>

</table>
</td>
<td width="10"><img src="common/spacer10.gif" width="10" height="10"></td>
<td width="85%" valign="top" align="center">
<div align="center">
<table width="98%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap04-002.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Rheinwerk Computing /</a><a class="navnav" href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"> &lt;openbook&gt; /</a> <a href="index-2.html" class="navnav"> Linux-UNIX-Programmierung</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap04-004.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" valign="top">
<table width="100%" border="0" cellpadding="10" cellspacing="0" class="box">
<tr>
<td colspan="2"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup" class="buchtitel">Linux-UNIX-Programmierung</a><span class="autor"> von J&uuml;rgen Wolf</span><br><span class="untertitel">Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006</span></td>
</tr>
<tr>
<td valign="top" width="90"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup"><img src="common/9783898427494.gif" border="0" alt="Buch: Linux-UNIX-Programmierung" title="Buch: Linux-UNIX-Programmierung" align="left"><br /><br /><span class="autor"><strong>Linux-UNIX-Programmierung</strong><br />1216 S., mit CD, 49,90 Euro<br />Rheinwerk Computing<br />ISBN 3-89842-749-8</span></a></a></td>
<td width="80%">
<table border="0">
<tr>
<td valign="baseline"><img src="common/pfeil_u.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="3" class="kap"><b>Kapitel <a href="Kap04-000.html#RxxKap04000040001181F03C100">4 Zugriff auf Systeminformationen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap04-000.html#RxxKap04000040001181F03C10B">4.1 Informationen aus dem /proc-Verzeichnis herausziehen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap04-001.html#RxxKap04001040001351F039100">4.2 Hardware-/Systeminformationen ermitteln</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-001.html#RxxKap04001040001351F039104">4.2.1 CPU-Informationen – /proc/cpuinfo</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-001.html#RxxKap04001040001351F03910D">4.2.2 Ger&auml;teinformationen – /proc/devices</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-001.html#RxxKap04001040001351F03910F">4.2.3 PCI-Bus – /proc/pci (nicht 2.6)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-001.html#RxxKap04001040001351F039111">4.2.4 Speicherauslastung – /proc/meminfo</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-001.html#RxxKap04001040001351F039113">4.2.5 Weitere Hardware-Informationen zusammengefasst</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap04-002.html#RxxKap04002040001361F01F100">4.3 Prozessinformationen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-002.html#RxxKap04002040001361F01F108">4.3.1 /proc/$pid/cmdline</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-002.html#RxxKap04002040001361F01F112">4.3.2 /proc/$pid/environ</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-002.html#RxxKap04002040001361F01F117">4.3.3 /proc/self</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-002.html#RxxKap04002040001361F01F17A">4.3.4 /proc/$pid/fd/</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-002.html#RxxKap04002040001361F01F182">4.3.5 /proc/$pid/statm</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a class="navh2" href="#RxxKap04003040001371F03C100">4.4 Kernel-Informationen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap04003040001371F03C117">4.4.1 /proc/locks</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap04003040001371F03C17A">4.4.2 /proc/modules</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap04-004.html#RxxKap04004040001381F03E100">4.5 Filesysteme</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap04-004.html#RxxKap04004040001381F03E102">4.5.1 /proc/mounts</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap04-005.html#RxxKap04005040001391F039100">4.6 Weiterf&uuml;hrendes</a></b></td>
</tr>
</table><br></td>
</tr>
</table>
<table width="100%" cellpadding="20" cellspacing="0" border="0" bgcolor="#eeeeee">
<tr>
<td>
<a name="t21"></a><a name="t2t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div>
<h2 class="t2">4.4 <a id="RxxKap0496KernelInformationen" name="RxxKap0496KernelInformationen"></a>Kernel-Informatione<a id="RxxKap04003040001371F03C100" name="RxxKap04003040001371F03C100"></a>n 
      <a href="#t2t32"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"></h2>
<p><a id="Xxx999235" name="Xxx999235"></a><a id="Xxx999236" name="Xxx999236"></a>Viele Eintr&auml;ge im <span class="listing">/proc</span>-Verzeichnis geben auch Informationen zum laufenden Kernel aus. Der Ort der Kernel-Informationen ist unterschiedlich, viele liegen im <span class="listing">/proc</span>-Verzeichnis selbst und weitere in den Unterverzeichnissen wie <span class="listing">/proc/sys</span> oder <span class="listing">/proc/sys/kernel</span>.</p>
<p>Hierzu einige h&auml;ufig ben&ouml;tigte Informationen, die in viele Anwendungen integriert sind<a id="Xxx999238" name="Xxx999238"></a><a id="Xxx999239" name="Xxx999239"></a><a id="Xxx999240" name="Xxx999240"></a><a id="Xxx999241" name="Xxx999241"></a>:</p>
<pre>$ cat /proc/sys/kernel/ostype
Linux
$ cat /proc/sys/kernel/osrelease
2.6.4-HX
$ cat /proc/sys/kernel/version
#14 Mon May 31 12:13:37 CEST 2004
$ cat /proc/sys/kernel/ctrl-alt-del
0</pre>
<p>Zuerst wurde abgefragt, was f&uuml;r ein Betriebssystem genau hier l&auml;uft (<span class="listing">ostype</span>), dann die Version des Kernels (<span class="listing">osrelease</span>) und wann dieser Kernel kompiliert wurde (<span class="listing">version</span>). Bei der letzten Abfrage wird &uuml;berpr&uuml;ft, ob <span class="listing">ctrl-alt-del</span> gesetzt ist. Damit k&ouml;nnen Sie beeinflussen, ob init bei der Tastenkombination <b>(STR)</b>+<b>(ALT)</b>+<b>(DEL)</b> eine Aktion ausf&uuml;hren soll. Steht »<span class="listing">ctrl-alt-del</span>« auf 1, wird bei Tastendruck sofort ein BIOS-Reboot angeordnet. Steht »<span class="listing">ctrl-alt-del</span>« allerdings auf 0, wird init dazu angehalten, das System ordentlich herunterzufahren Wollen Sie diesen Parameter ver&auml;ndern, m&uuml;ssen Sie sich schnell als Superuser darstellen:</p>
<pre>$ su
Password:********
# echo 1 &gt;&gt; /proc/sys/kernel/ctrl-alt-del
# exit
exit
$ cat /proc/sys/kernel/ctrl-alt-del
1</pre>
<p><a id="Xxx999246" name="Xxx999246"></a>Ein weiteres Beispiel. Sie haben eine CD-ROM eingelegt und gemountet. Nachdem Sie die Daten von der CD-ROM gelesen haben, werfen Sie die CD-ROM ordnungsgem&auml;&szlig; mit umount wieder aus und fahren anschlie&szlig;end das System herunter. Jetzt ben&ouml;tigen Sie aber die CD-ROM f&uuml;r einen Bekannten. Somit m&uuml;ssen Sie den PC leider nochmals anschalten. W&auml;re doch nett, wenn beim Ausgeben der CD-ROM die CD ausgeworfen wird. F&uuml;r solche F&auml;lle ist der Eintrag in <span class="listing">/proc/sys/dev/cdrom/autoeject</span> zust&auml;ndig. Der Wert ist mit der Voreinstellung 0 versehen. Folgenderma&szlig;en k&ouml;nnen Sie dabei vorgehen, um den Wert auf 1 zu setzen:</p>
<pre>$ mount /media/cdrom
$ cat /proc/sys/dev/cdrom/autoeject
0
$ su
Password:********
# echo 1 &gt;&gt; /proc/sys/dev/cdrom/autoeject
# exit
exit
$ cat /proc/sys/dev/cdrom/autoeject
1
$ umount /media/cdrom</pre>
<p>Beim Aush&auml;ngen des CD-ROM-Laufwerkes m&uuml;sste jetzt die CD ausgeworfen werden. Dieses nette Feature zeigt allerdings schon recht fr&uuml;h seine Schattenseiten, z. B. wenn die Hardwareerkennung oder das Installationsprogramm das Device mehrmals &ouml;ffnet und schlie&szlig;t. Besonders fies auf engem Raum, wo Ihr CD-Laufwerk leiden wird, wenn es sich nicht vollst&auml;ndig &ouml;ffnen kann.</p>
<p>Sie hacken &uuml;brigens damit nicht im System herum. Viele dieser Kernel-Parameter wurden bewusst so implementiert, damit Sie den Bed&uuml;rfnissen der Anwender angepasst werden k&ouml;nnen, um ein h&ouml;chstes Ma&szlig; an Flexibilit&auml;t zu erreichen. Da dabei in der Regel Superuser-Rechte ben&ouml;tigt werden, sind diese Einstellungen meistens f&uuml;r den Systemadministrator vorgesehen. Daher macht es relativ wenig Sinn, wenn Sie in Ihrer Anwendung, die Sie schreiben, versuchen, die Kernel-Parameter zu ver&auml;ndern. Dies w&uuml;rde bedeuten, dass Ihre Anwendung im Superuser-Modus laufen m&uuml;sste. Bedenken Sie, dass dies nicht immer m&ouml;glich ist – und auch nicht sein sollte.</p>
<p>F&uuml;r administrative Zwecke soll hierf&uuml;r jedoch eine solche Anwendung erstellt werden. Aber wie schon erw&auml;hnt, Sie ben&ouml;tigen Superuser- Rechte (bzw. root-Rechte) f&uuml;r dieses Programm, sollten Sie etwas ver&auml;ndern wollen. Versucht der normale Anwender, etwas zu ver&auml;ndern, bekommt er ein »Permission denied« zur&uuml;ckgegeben. Hier das Beispiel mit anschlie&szlig;ender Erl&auml;uterung.</p>
<pre><a id="Xxx999252" name="Xxx999252"></a>/* kernelinf.c */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd. h.&gt;
#include &lt;string.h&gt;
#define BUF 4096
enum { EJECT, FILE_MAX, SHARED_MAX  };
enum { CDINFO, OS, RELEASE, VERSION };
static const char *sys[] = {
  /* Bei umount CD auswerfen */
  "/proc/sys/dev/cdrom/autoeject",
  /* max. Anzahl ge&ouml;ffneter Dateien pro Prozess */
  "/proc/sys/fs/file-max",
  /*max. Gr&ouml;&szlig;e geteilter Speicher (Shared Memory) */
  "/proc/sys/kernel/shmmax"
};
static const char *info[] = {
  "/proc/sys/dev/cdrom/info",   /* Infos zur CD-ROM      */
  "/proc/sys/kernel/ostype",    /* Welches Betriebssystem  */
  "/proc/sys/kernel/osrelease"  /* Kernel-Version          */
  "/proc/sys/kernel/version"    /* Kernel von wann        */
};
static char *get_info (const char *inf) {
  FILE *fp;
  static char buffer[BUF];
  size_t bytes_read;
  fp = fopen (inf, "r");
  if (fp == NULL) {
    perror("fopen()");
    return NULL;   /* Fehler beim &Ouml;ffnen */
  }
  bytes_read = fread (buffer, 1, sizeof (buffer), fp);
  fclose (fp);
  if (bytes_read == 0 || bytes_read == sizeof (buffer))
    return NULL;
  buffer[bytes_read] = '\0';
  return buffer;
}
static void set_sys (const char *sys, unsigned long set) {
  FILE *fp;
  char buf[32];
  fp = fopen (sys, "w");
  if (fp == NULL) {
    perror ("fopen()");
    printf ("Weiter mit ENTER\n");
    getchar ();
    return;
  }
  sprintf(buf, "%ld", set);
  fprintf (fp, "%s", buf);
  fclose (fp);
  return;
}
int main (int argc, char **argv) {
  int auswahl;
  unsigned int file_max;
  unsigned long shared_max;
  do {
    printf ("Aktueller Zustand\n");
    printf ("Betriebssystem : %s", get_info (info[OS]));
    printf ("Kernel-Version  : %s", 
       get_info (info[RELEASE]));
    printf ("Datum          : %s",
       get_info (info[VERSION]));
    printf ("------------------------------------\n");
    printf ("Ver&auml;ndern k&ouml;nnen Sie Folgendes ...\n");
    printf ("-0- Bei \"umount\"  CD auswerfen"
            " Aktuell:%s", get_info (sys[EJECT]));
    printf ("-1- Max. Anzahl ge&ouml;ffneter Dateien pro"
            " Prozess    Aktuell:%s",
               get_info (sys[FILE_MAX]));
    printf ("-2- Max. Gr&ouml;&szlig;e des geteilten Speichers"
            " (KB)     Aktuell %s",
               get_info (sys[SHARED_MAX]));
    printf ("------------------------------------\n");
    printf ("Informationen bekommen Sie zu ...\n");
    printf ("-3- CD-ROM\n");
    printf ("------------------------------------\n");
    printf ("-4- ENDE\n");
    printf ("Ihre Auswahl bitte (0–4) : ");
    do { scanf ("%d", &amp;auswahl); } while (getchar ()!='\n');
    switch (auswahl) {
    case EJECT:
      if (strncmp ("0", get_info (sys[EJECT]),1) == 0)
        set_sys (sys[EJECT], 1); /* Setzen      */
      else                       /* Zur&uuml;cksetzen */
        set_sys (sys[EJECT], 0);
      break;
    case FILE_MAX:
      printf ("Welcher Wert soll gesetzt werden : ");
      do{ scanf("%d", &amp;file_max); } while (getchar()!='\n');
      set_sys (sys[FILE_MAX], file_max);
      break;
    case SHARED_MAX:
      printf ("Welcher Wert soll gesetzt werden : ");
      do { scanf("%ld", &amp;shared_max); }
      while (getchar()!='\n');
      set_sys (sys[SHARED_MAX], shared_max);
      break;
    case 3:
      printf ("%s", get_info (info[CDINFO]));
      printf ("Weiter mit ENTER\n");
      getchar ();
      break;
    case 4:
      printf("Programm wird beendet\n");
      break;
    default:
      printf ("Unbekannte Eingabe\n");
    }
  } while (auswahl != 4);
  return EXIT_SUCCESS;
}</pre>
<p>Das Programm bei der Ausf&uuml;hrung:</p>
<pre>$ gcc -o kernelinf kernelinf.c
$ ./kernelinf
Aktueller Zustand
Betriebssystem : Linux
Kernel-Version  : 2.4.20–4GB
Datum          : #1 Mon Mar 17 17:54:44 UTC 2003
------------------------------------
Ver&auml;ndern k&ouml;nnen Sie Folgendes ...
-0- Bei "umount" CD auswerfen                    Aktuell:1
-1- Max. Anzahl ge&ouml;ffneter Dateien pro Prozess   Aktuell:32000
-2- Max. Gr&ouml;&szlig;e des geteilten Speichers (KB)      Aktuell 30000000
------------------------------------
Informationen bekommen Sie zu ...
-3- CD-ROM
------------------------------------
-4- ENDE
Ihre Auswahl bitte (0–4) : </pre>
<p>Neben dem Auswerfen der CD-ROM bei umount k&ouml;nnen hier noch die maximale Anzahl gleichzeitig ge&ouml;ffneter Dateien pro Prozess und die maximale Gr&ouml;&szlig;e des geteilten Speichers (Shared Memory) ver&auml;ndert werden. Diese Ver&auml;nderungen k&ouml;nnen aber wie bereits erw&auml;hnt nur mit speziellen Rechten vorgenommen werden. Informationen zum CD-ROM-Laufwerk, was es alles kann, k&ouml;nnen wieder f&uuml;r alle Anwender aufgelistet werden.</p>
<p>Bitte beachten Sie, dass diese Art von Ver&auml;nderungen der Kernel-Parameter nur f&uuml;r den laufenden Betrieb g&uuml;ltig ist. Sobald Sie das System herunterfahren und wieder starten, sind die Werte wieder auf ihren Ursprungszustand gestellt. Wollen Sie eine dauerhafte Ver&auml;nderung bewirken, m&uuml;ssen Sie sich die Datei <span class="listing">sysctl.conf</span> im Verzeichnis <span class="listing">/etc</span> vornehmen. Diese Datei k&ouml;nnen Sie auch mit dem gleichnamigen Kommando <span class="listing">sysctl</span> ver&auml;ndern. Wollen Sie z. B. mit <span class="listing">sysctl</span> autoeject ver&auml;ndern, gehen Sie wie folgt vor (root-Rechte):</p>
<pre># sysctl -w dev.cdrom.autoeject=0
dev.cdrom.autoeject = 0
# sysctl -w dev.cdrom.autoeject=1
dev.cdrom.autoeject = 1</pre>
<p>Auf die Angaben von <span class="listing">/proc/sys</span> k&ouml;nnen Sie dabei verzichten, und anstelle eines Slashs wird ein Punkt verwendet.</p>
<p>Wollen Sie wissen, mit welchem Befehl der Kernel beim Booten gestartet wurde, k&ouml;nnen Sie ihn mit <span class="listing">cmdline</span> erfragen:</p>
<pre>$ cat /proc/cmdline
root=/dev/hda6 vga=0x0314  hdc=ide-scsi hdclun=0 splash=silent</pre>
<p>Oder Linux 2.6 mit LILO 22.3.4:</p>
<pre>auto BOOT_IMAGE=2.6.4-HX ro root=301</pre>
<p>Zu den verschiedenen Bootoptionen sei hier der Verweis auf die bootparam(7) Manual Page gegeben. Es gibt noch weitaus mehr zu den Kernel-Informationen zu sagen, aber das w&uuml;rde den Rahmen des Buches bei weitem sprengen und am Thema der Linux-Programmierung vorbeigehen.</p>
<a name="t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t32"></a><h3 class="t3">4.4.1 /proc/locks<a id="RxxKap04003040001371F03C117" name="RxxKap04003040001371F03C117"></a> 
      <a href="#t2t33"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t31"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999266" name="Xxx999266"></a>Mit dieser Datei werden alle Dateien angezeigt, die im Augenblick vom Kernel gesperrt werden (vgl. Kapitel 2 &uuml;ber <span class="listing">flock()</span> und <span class="listing">lockf()</span>). Diese Ausgabe enth&auml;lt interne Kernel-Debugging-Daten und kann daher logischerweise je nach System stark variieren.</p>
<pre>1: FLOCK ADVISORY WRITE 807 03:05:308731 0 EOF c2ac0 c0248 c2a220
2: POSIX ADVISORY WRITE 708 03:05:308720 0 EOF c2a1c c2ac4 c02548</pre>
<p>In der ersten Spalte besitzt jeder Lock eine einmalige Zahl gefolgt vom Typ des Locks. M&ouml;gliche Ausgaben sind hier FLOCK (meist bei &auml;lteren UNIX-Datei-Locks mit dem Systemaufruf <span class="listing">flock()</span>) und POSIX (bei neueren POSIX-Locks mit dem Systemaufruf <span class="listing">lockf()</span>).</p>
<p>Der Wert ADVISORY der dritten Spalte bedeutet, dass ein weiterer Datenzugriff f&uuml;r andere Benutzer m&ouml;glich ist, aber keine weiteren Lock-Versuche mehr erlaubt sind. Ein anderer Wert hierf&uuml;r w&auml;re MANDATORY, was bedeutet, dass hier keine Datenzugriffe mehr m&ouml;glich sind, solange der Lock vorhanden ist. In der vierten Spalte befinden sich die Lese- oder Schreibrechte (READ, WRITE) des Eigent&uuml;mers. Die f&uuml;nfte Spalte enth&auml;lt die PID des Lock-Eigent&uuml;mers. Die ID der gelockten Datei finden Sie in der sechsten Spalte mit folgendem Format:</p>
<pre>MAJOR-DEVICE:MINOR-DEVICE:INODE-NUMBER</pre>
<p>Die Spalten sechs und sieben zeigen Anfang und Ende der gelockten Region. Im Beispiel gilt die Sperre vom Anfang 0 bis zum Ende (EOF) der Datei. Die letzten Spalten zeigen auf Kernel-interne Datenstrukturen f&uuml;r spezielle Debugging-Funktionen.</p>
<a name="t32"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t33"></a><h3 class="t3">4.4.2 /proc/modules<a id="RxxKap04003040001371F03C17A" name="RxxKap04003040001371F03C17A"></a> 
      <img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"><a href="#t2t32"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999274" name="Xxx999274"></a>In <span class="listing">/proc/modules</span> finden Sie eine Liste von allen Modulen, die vom System geladen wurden. Auch hierbei h&auml;ngt die Ausgabe von den Einstellungen des Systems ab.</p>
<pre>ide-cd                 27008   0 (autoclean)
cdrom                  28960   0 (autoclean) [ide-cd]
soundcore               4100   0 (autoclean)
agpgart                31072   0 (unused)
iscsi                  32672   0 (unused)
scsi_mod               94424   1 [iscsi]
autofs                 10628   0 (autoclean) (unused)</pre>
<p>In der ersten Spalte befindet sich jeweils der Name des geladenen Moduls, gefolgt von der Speichergr&ouml;&szlig;e in Bytes. In der dritten Spalte wird angezeigt, wie oft das Modul gerade benutzt wird (usage count). In der letzten Spalte finden Sie die Module, die ben&ouml;tigt werden, damit andere Module funktionieren. Z. B. ben&ouml;tigt das Modul cdrom das Modul ide-cd, um ordentlich ausgef&uuml;hrt zu werden. »<span class="listing">autoclean</span>« gibt an, ob sich das Modul nach einer gewissen Zeit selbst deaktiviert, »<span class="listing">unused</span>«, dass es nicht benutzt wird.</p>
<h4 class="t4">/proc/modules in 2.6</h4>
<p>In 2.6 sieht <span class="listing">/proc/modules</span> etwas anders aus; die Ausgabe von lsmod hat sich hingegen nicht ge&auml;ndert. Zun&auml;chst verschwunden sind <span class="listing">autoclean</span> und <span class="listing">unused</span>; <span class="listing">modules</span> selbst sieht in etwa so aus:</p>
<pre>usb_storage 62400 0 - Live 0xd092e000
usbcore 85340 5 ehci_hcd,ohci_hcd,usb_storage, Live 0xd096c000
scsi_mod 58492 3 sd_mod,sg,usb_storage, Live 0xd0942000
ide_cd 34500 1 - Live 0xd0924000
cdrom 36128 1 ide_cd, Live 0xd091a000</pre>
<p>&Auml;hnlich wie in 2.4 finden sich hier Name des Moduls, Gr&ouml;&szlig;e, der Usage Count, basierende Module, der Zustand (Loading, Unloading, Live = geladen) und die Adresse, wo das Modul geladen ist.</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap04-002.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a class="navnav" href="#">&lt;top&gt;</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap04-004.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
</td>
<td width="10" valign="top">&nbsp;&nbsp;</td>
<td width="160" valign="top">
    <table border="0" cellpadding="0" cellspacing="0" width="160">
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">
                            &nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs">
                            <strong>Zum Katalog</strong></a>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2">
                            <img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><a href="https://www.rheinwerk-verlag.de/linux-unix-programmierung_1137/?GPP=oplup">
                                        <img src="common/749.gif"  border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-UNIX-Programmierung" title="Zum Katalog: Linux-UNIX-Programmierung">
                                        <br /><strong>Linux-UNIX-<br />Programmierung</strong><br /><img src="common/pfeil_rechts5.gif" border="0" alt="">bestellen</a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Ihre Meinung?</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td>Wie hat Ihnen das &lt;openbook&gt; gefallen?<br /><a href="https://www.rheinwerk-verlag.de/feedback/"><img src="common/pfeil_rechts5.gif" border="0" alt="">Ihre Meinung</a>
                                    <br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">&nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs"><strong>Buchtipps</strong></a></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-server_3685/?GPP=oplup">
                        <img src="common/3020.gif" width="78" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Server" title="Zum Katalog: Linux-Server"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-Server</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/das-komplettpaket-lpic-1-lpic-2_3782/?GPP=oplup">
                        <img src="common/3529.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2" title="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2"><br /><br /><br /><br /><br /><br /><br />&nbsp;Das Komplettpaket<br />&nbsp;LPIC-1 &amp; LPIC-2</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-hochverfugbarkeit_3420/?GPP=oplup">
                        <img src="common/2542.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Hochverfügbarkeit" title="Zum Katalog: Linux-Hochverfügbarkeit"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-<br />&nbsp;Hochverfügbarkeit</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/shell-programmierung_3345/?GPP=oplup">
                        <img src="common/2310.gif" width="69" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Shell-Programmierung" title="Zum Katalog: Shell-Programmierung"><br /><br /><br /><br /><br /><br /><br />&nbsp;Shell-<br />&nbsp;Programmierung</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux_3436/?GPP=oplup">
                        <img src="common/2591.gif" width="79" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux Handbuch" title="Zum Katalog: Linux Handbuch"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux Handbuch</a><br /><br /></td>
                    </tr>
                </table></td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Shopping</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><b>Versandkostenfrei</b> bestellen in Deutschland und &Ouml;sterreich<br /><a href="https://www.rheinwerk-verlag.de/hilfe/bestellung_6?GPP=oplup"><img src="common/pfeil_rechts5.gif" border="0" alt="">Info</a><br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</td>
</tr>
</table>
<br /><br />
<hr width="70%" align="center">
<br />
<div align="center">
    <p class="standard">
        <strong>Copyright © Rheinwerk Verlag GmbH 2006</strong>
        <br />F&uuml;r Ihren privaten Gebrauch d&uuml;rfen Sie die Online-Version nat&uuml;rlich 
        ausdrucken. Ansonsten unterliegt das &lt;openbook&gt; denselben Bestimmungen, 
        wie die gebundene Ausgabe: Das Werk einschlie&szlig;lich aller seiner Teile ist 
        urheberrechtlich gesch&uuml;tzt. Alle Rechte vorbehalten einschlie&szlig;lich der 
        Vervielf&auml;ltigung, &Uuml;bersetzung, Mikroverfilmung sowie Einspeicherung und 
        Verarbeitung in elektronischen Systemen.
    </p>
    <br><a href="https://www.rheinwerk-verlag.de/">[Rheinwerk Computing]</a>
    <br /><br />Rheinwerk Verlag GmbH, Rheinwerkallee 4, 53227 Bonn, 
    Tel.: 0228.42150.0, Fax 0228.42150.77, 
    <a href="mailto:service@rheinwerk-verlag.de">service@rheinwerk-verlag.de</a>
</div>
<br /><br />
</body>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap04-003.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:10 GMT -->
</html>
