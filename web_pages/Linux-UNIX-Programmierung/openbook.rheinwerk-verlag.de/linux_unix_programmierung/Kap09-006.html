<html>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap09-006.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:26 GMT -->
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Linux-UNIX-Programmierung – 9.7 Shared Memory</title>
<meta name="title" content="Linux-UNIX-Programmierung">
<meta name="author" content="J&uuml;rgen Wolf">
<meta name="publisher" content="Rheinwerk Verlag GmbH 2006">
<meta name="copyright" content="Rheinwerk Verlag GmbH 2006">
<meta name="description" content="Linux-UNIX-Programmierung - Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006 – ISBN 3-89842-749-8">
<meta name="audience" content="Alle">
<meta name="robots" content="INDEX,FOLLOW">
<meta http-equiv="content-language" content="de">
<link rel="stylesheet" type="text/css" href="common/rw_open.css">
<link rel="prev" href="Kap09-005.html">
<link rel="next" href="Kap10-000.html"><script type="text/javascript" language="JavaScript"><!--
function OpenWin(url,name,height,width)
{
  var InfoWin = window.open(url,name,"directories=0,height="+height+",width=" + width + ",hotkeys=0,location=0,menubar=0,resizable=1,screenX=150,screenY=10,left=150,top=10,scrollbars=1,status=1,titlebar=0,toolbar=0");
  InfoWin.focus();
}
//--></script></head>
<body vlink="#000099" link="#000099" alink="#000099">
<table width="100%" height="74" border="0" cellpadding="0" cellspacing="0" bgcolor="#00549d">
<tr>
<td height="74" valign="bottom" colspan="2"><a href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"><img src="common/rw_openbook.gif" width="200" height="56" border="0" alt="Rheinwerk Computing < openbook >"></a></td>
<td width="80" height="74">
<a href="https://www.rheinwerk-verlag.de/?GPP=oplup"><img src="common/rw_computing.gif" border="0" alt="Rheinwerk Computing - Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger."></a>
</td>
</tr>
</table><div align="right"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger</a></div><br /><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="156" valign="top"><table border="0" cellpadding="0" cellspacing="0" width="100%" align="left">
<tr>
<td colspan="2" class="nav1" align="left" valign="top" height="150">
<table class="tbl1" width="150" border="0" cellpadding="3" cellspacing="0">
<tr>
<td class="tbl2" height="25"><A class="nav" href="index-2.html">Inhaltsverzeichnis</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00a-000.html#Xxx999195">Vorwort des Autors</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00b-000.html#Xxx999195">Vorwort der Fachgutachter</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap01-000.html#Xxx999235">1 Einf&uuml;hrung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap02-000.html#Xxx999234">2 E/A-Funktionen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap03-000.html#Xxx999234">3 Attribute von Dateien und Verzeichnissen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap04-000.html#Xxx999234">4 Zugriff auf Systeminformationen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap05-000.html#Xxx999234">5 Devices – eine einfache Verbindung zur Hardware</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap06-000.html#Xxx999234">6 System- und Benutzerdateien</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap07-000.html#Xxx999234">7 D&auml;monen, Zombies und Prozesse</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap08-000.html#Xxx999235">8 Signale</A></td>
</tr>
<tr>
<td><A class="navnavh" href="Kap09-000.html#Xxx999235">9 IPC – Interprozesskommunikation</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap10-000.html#Xxx999234">10 Threads</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap11-000.html#Xxx999235">11 Netzwerkprogrammierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap12-000.html#Xxx999236">12 MySQL und PostgreSQL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap13-000.html#Xxx999235">13 Terminal E/A und Benutzerschnittstellen f&uuml;r die Konsole</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap14-000.html#Xxx999235">14 Xlib – X Window-Programmierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap15-000.html#Xxx999235">15 GTK+</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap16-000.html#Xxx999235">16 SDL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap17-000.html#Xxx999247">17 Werkzeuge f&uuml;r Programmierer</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18A-000.html#Xxx999248">A Sicherheit unter Linux</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18B-000.html#Xxx999245">B Funktionsreferenz</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18C-000.html#Xxx999245">C Inhalt der Buch-CD</A></td>
</tr>
<tr>
<td><A class="navnav" href="stichwort.html#Xxx537584">Index</A></td>
</tr>
<tr><td><br /><!--<a class="navnav" href="http://download.galileo-press.de/openbook/lup/galileocomputing_linux_unix_programmierung.zip"><strong>Download:</strong><br />- ZIP, ca. 4,3 MB</a></td></tr>
<tr><td><a class="navnav" href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup">Buch bestellen</a></td></tr>
<tr><td>--><a class="navnav" href="https://www.rheinwerk-verlag.de/feedback/">Ihre Meinung?</a><br /><br /></td></tr>
</table></td>
</tr>

</table>
</td>
<td width="10"><img src="common/spacer10.gif" width="10" height="10"></td>
<td width="85%" valign="top" align="center">
<div align="center">
<table width="98%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap09-005.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Rheinwerk Computing /</a><a class="navnav" href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"> &lt;openbook&gt; /</a> <a href="index-2.html" class="navnav"> Linux-UNIX-Programmierung</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap10-000.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" valign="top">
<table width="100%" border="0" cellpadding="10" cellspacing="0" class="box">
<tr>
<td colspan="2"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup" class="buchtitel">Linux-UNIX-Programmierung</a><span class="autor"> von J&uuml;rgen Wolf</span><br><span class="untertitel">Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006</span></td>
</tr>
<tr>
<td valign="top" width="90"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup"><img src="common/9783898427494.gif" border="0" alt="Buch: Linux-UNIX-Programmierung" title="Buch: Linux-UNIX-Programmierung" align="left"><br /><br /><span class="autor"><strong>Linux-UNIX-Programmierung</strong><br />1216 S., mit CD, 49,90 Euro<br />Rheinwerk Computing<br />ISBN 3-89842-749-8</span></a></a></td>
<td width="80%">
<table border="0">
<tr>
<td valign="baseline"><img src="common/pfeil_u.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="3" class="kap"><b>Kapitel <a href="Kap09-000.html#RxxKap09000040002B71F02D100">9 IPC – Interprozesskommunikation</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-000.html#RxxKap09000040002B71F02D10B">9.1 Unterschiedliche Interprozesskommunikations-Techniken im &Uuml;berblick</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D10D">9.1.1 (Namenlose) Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D117">9.1.2 Benannte Pipes (FIFO-Pipes)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D183">9.1.3 Message Queue (Nachrichtenspeicher)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D187">9.1.4 Semaphore</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D18A">9.1.5 Shared Memory (gemeinsamer Speicher)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D18D">9.1.6 STREAMS</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D195">9.1.7 Sockets</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D197">9.1.8 Lock Files (Sperrdateien)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D19A">9.1.9 Dateisperren (Record Locking)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-001.html#RxxKap09001040002D41F046100">9.2 Gr&uuml;nde f&uuml;r IPC</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-002.html#RxxKap09002040002D51F049100">9.3 Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049104">9.3.1 Eigenschaften von Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049108">9.3.2 Pipes einrichten – pipe()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049182">9.3.3 Eigenschaften von elementaren E/A-Funktionen bei Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049188">9.3.4 Standard-E/A-Funktionen mit pipe</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049192">9.3.5 Pipes in einen anderen Prozess umleiten</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F04919A">9.3.6 Filterprogramm erstellen mithilfe einer Pipe</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491A6">9.3.7 Einrichten einer Pipe zu einem anderen Prozess – popen()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491B8">9.3.8 Mail versenden mit Pipes und Sendmail</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491C2">9.3.9 Drucken &uuml;ber eine Pipe mit lpr</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491D5">9.3.10 Benannte Pipes – FIFOs</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-003.html#RxxKap09003040002D61F02A100">9.4 System-V-Interprozesskommunikation</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A102">9.4.1 Gemeinsamkeiten der SysV-Mechanismen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A10D">9.4.2 Ein Objekt einrichten, eine Verbindung herstellen und das Objekt wieder l&ouml;schen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A111">9.4.3 Datenaustausch zwischen nicht verwandten Prozessen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-004.html#RxxKap09004040002D71F017100">9.5 Semaphore</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-004.html#RxxKap09004040002D71F017104">9.5.1 Lebenszyklus eines Semaphors</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-004.html#RxxKap09004040002D71F017116">9.5.2 Ein Semaphor &ouml;ffnen oder erstellen – semget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-004.html#RxxKap09004040002D71F01717D">9.5.3 Abfragen, &Auml;ndern oder L&ouml;schen der Semaphormenge – semctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-004.html#RxxKap09004040002D71F0171A1">9.5.4 Operationen auf Semaphormengen – semop()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-004.html#RxxKap09004040002D71F0171B3">9.5.5 Semaphore im Vergleich mit Sperren</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-005.html#RxxKap09005040002D81F03B100">9.6 Message Queues</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B109">9.6.1 Eine Message Queue &ouml;ffnen oder erzeugen – msgget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B111">9.6.2 Nachrichten versenden – msgsnd()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B176">9.6.3 Eine Nachricht empfangen – msgrcv()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B17E">9.6.4 Abfragen, &Auml;ndern oder L&ouml;schen einer Message Queue – msgctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a class="navh2" href="#RxxKap09006040002D91F028100">9.7 Shared Memory</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09006040002D91F028102">9.7.1 Ein Shared-Memory-Segment erstellen oder &ouml;ffnen – shmget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09006040002D91F02810A">9.7.2 Ein Shared-Memory-Segment abfragen, &auml;ndern oder l&ouml;schen – shmctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09006040002D91F028117">9.7.3 Ein Shared-Memory-Segment anbinden (attach) – shmat()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09006040002D91F02817D">9.7.4 Ein Shared-Memory-Segment losl&ouml;sen – shmdt()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09006040002D91F028181">9.7.5 Client-Server-Beispiel – Shared Memory</a></b></td>
</tr>
</table><br></td>
</tr>
</table>
<table width="100%" cellpadding="20" cellspacing="0" border="0" bgcolor="#eeeeee">
<tr>
<td>
<a name="t21"></a><a name="t2t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div>
<h2 class="t2">9.7 <a id="RxxKap09377SharedMemory" name="RxxKap09377SharedMemory"></a>Shared Memo<a id="RxxKap09006040002D91F028100" name="RxxKap09006040002D91F028100"></a>ry 
      <a href="#t2t32"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"></h2>
<p><a id="Xxx999236" name="Xxx999236"></a><a id="Xxx999237" name="Xxx999237"></a><a id="Xxx999238" name="Xxx999238"></a>Shared Memory ist ein vom Kernel verwalteter Speicherbereich, der von mehreren Prozessen gelesen und beschrieben werden kann. Es muss dabei lediglich beachtet werden, dass die einzelnen Prozesse untereinander abgeglichen, also synchronisiert werden m&uuml;ssen. Au&szlig;erdem ist diese Form der Interprozesskommunikation die schnellste von allen, da kein Kopieren von Clientprogrammen zum Serverprogramm (oder auch umgekehrt) n&ouml;tig ist, weil ein gemeinsamer Speicherbereich verwendet wird. Damit es nicht vorkommt, dass mehr als ein Prozess aus diesem Segment lesend und vor allem nicht schreibend zugreift, verwendet man h&auml;ufig dazu Sperren (Record Locks) oder Semaphore. Ein solches Shared-Memory-Segment existiert auch nach der Beendigung seines Erzeugers, sofern nicht das Flag <span class="listing">IPC_RMID</span> angegeben wurde.</p>
<a name="t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t32"></a><h3 class="t3">9.7.1 Ein Shared-Memory-Segment erstellen oder &ouml;ffnen – shmget()<a id="RxxKap09006040002D91F028102" name="RxxKap09006040002D91F028102"></a> 
      <a href="#t2t33"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t31"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999241" name="Xxx999241"></a><a id="Xxx999242" name="Xxx999242"></a>Wollen Sie ein Shared-Memory-Segment erzeugen oder ein bereits existierendes &ouml;ffnen, dann m&uuml;ssen Sie die Funktion <span class="listing">shmget()</span> verwenden:<a id="Xxx999244" name="Xxx999244"></a></p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
int shmget(key_t key, int size, int flag);</pre>
<p>Als erstes Argument erh&auml;lt diese Funktion, wie schon bei den anderen SysV-Interprozesskommunikationen, die »magische« Nummer <span class="listing">key</span>. Mit <span class="listing">size</span> geben Sie die Mindestgr&ouml;&szlig;e des neu anzulegenden Shared-Memory-Segmentes an. Gew&ouml;hnlich sind hierf&uuml;r die Limits f&uuml;r die Mindestgr&ouml;&szlig;e in der symbolischen Konstante <span class="listing">SHMMIN<a id="Xxx999247" name="Xxx999247"></a></span> mit 1 und die max. Gr&ouml;&szlig;e in <span class="listing">SHMMAX<a id="Xxx999248" name="Xxx999248"></a></span> mit 131072 angegeben. Wollen Sie hingegen ein bereits existierendes Segment &ouml;ffnen, dann kann f&uuml;r <span class="listing">size</span> der Wert 0 angegeben werden. Auch bei den Flags gilt dasselbe wie schon bei den Message Queues und den Semaphoren:</p>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_PRIVATE<a id="Xxx999249" name="Xxx999249"></a></span> – &Ouml;ffnen eines privaten Schl&uuml;ssels</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_CREAT<a id="Xxx999251" name="Xxx999251"></a></span> – Damit wird ein noch nicht existierender Schl&uuml;ssel erzeugt.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_EXCL<a id="Xxx999253" name="Xxx999253"></a></span> – Dieses Flag wird in der Regel mit dem bitweisen ODER-Operator hinter <span class="listing">IPC_CREAT</span> angef&uuml;gt. Damit gehen Sie sicher, dass wirklich ein neues Objekt (ein Shared-Memory-Segment) angelegt wird und nicht ein bereits existierendes mit derselben Kennung. Existiert eine Kennung bereits, bricht die entsprechende Funktion – hier <span class="listing">shmget()</span> – mit einem Fehler ab (<span class="listing">errno</span> <span class="listing">=</span> <span class="listing">EEXIST)</span>.</td>
</tr>
</table>
<p>Auch hierbei sollten Sie bei den Flags die entsprechenden Zugriffsrechte setzen, damit Sie &uuml;berhaupt Zugriff auf ein Shared-Memory-Segment haben. Der R&uuml;ckgabewert der Funktion <span class="listing">shmget()</span> ist bei Erfolg die ID des gemeinsamen Speicherbereichs, die Sie bei den weiteren Funktionen ben&ouml;tigen, oder bei einem Fehler -1.</p>
<a name="t32"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t33"></a><h3 class="t3">9.7.2 Ein Shared-Memory-Segment abfragen, &auml;ndern oder l&ouml;schen – shmctl()<a id="RxxKap09006040002D91F02810A" name="RxxKap09006040002D91F02810A"></a> 
      <a href="#t2t34"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t32"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999257" name="Xxx999257"></a><a id="Xxx999258" name="Xxx999258"></a><a id="Xxx999259" name="Xxx999259"></a>Mit der Funktion <span class="listing">shmctl()</span> k&ouml;nnen Sie den Status eines Shared-Memory-Segmentes abfragen oder &auml;ndern. Aber auch zum L&ouml;schen eines Segments wird diese Funktion verwendet. Hier die Syntax:<a id="Xxx999261" name="Xxx999261"></a></p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
int shmctl(int shm_id, int kommando, struct shmid_ds *buf);</pre>
<p>Das erste Argument ist die ID des Shared-Memory-Segmentes, worauf sich die folgende Operation beziehen soll. Diese Kennung haben Sie bei Erfolg als R&uuml;ckgabewert der Funktion <span class="listing">shmget()</span> erhalten. Mit <span class="listing">kommando</span> legen Sie die Aktion des durchzuf&uuml;hrenden Kommandos fest. Hierbei k&ouml;nnen folgende Angaben gemacht werden (entsprechende Zugriffsrechte vorausgesetzt):</p>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_STAT<a id="Xxx999264" name="Xxx999264"></a></span> – Status des Shared-Memory-Segmentes abfragen. Der Status befindet sich in der Adresse der Struktur <span class="listing">shmid_ds</span> (drittes Argument von <span class="listing">shmctl</span>), die von jedem Shared-Memory-Segment angelegt wird.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_SET<a id="Xxx999266" name="Xxx999266"></a></span> – Setzen der GID/UID und Zugriffsrechte, die sich in der Struktur <span class="listing">shmid_ds</span> in der Adresse <span class="listing">buf</span> befinden.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_RMID<a id="Xxx999268" name="Xxx999268"></a></span> – L&ouml;schen eines Shared-Memory-Segments</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> SHM_LOCK<a id="Xxx999270" name="Xxx999270"></a></span> – Sperren eines Shared-Memory-Segments (nur Superuser)</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> SHM_UNLOCK<a id="Xxx999272" name="Xxx999272"></a></span> – Aufheben einer Sperre (logischerweise auch nur Superuser)</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_INFO<a id="Xxx999274" name="Xxx999274"></a></span> – (nur Linux) Damit k&ouml;nnen Informationen eines Shared-Memory-Segments erfragt werden.</td>
</tr>
</table>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<tr>
<td class="tabellentext" bgcolor="#000000">
<p class="BStandard"><b>Hinweis   </b>Das Abfragen und Setzen der einzelnen SysV-Interprozesskommunikationen mit den ...<span class="listing">ctl()</span>-Funktionen wurde recht kurz und oberfl&auml;chlich behandelt – was Ihnen aber, wenn Sie das Prinzip verstanden haben, kein allzu gro&szlig;es Problem bereiten sollte, weil es fast analog zu den bereits vorgestellten IPC-Mechanismen funktioniert. In der Regel l&auml;uft es immer nach demselben Schema ab. Als erstes Argument geben Sie die Kennung an, als zweites Argument das Kommando, und das letzte Argument ist meistens die Adresse einer f&uuml;r das SysV-Konzept entsprechenden Struktur, worauf sich das Kommando bezieht.</p>
</td>
</tr>
</table><br>
<p>Bei Erfolg gibt diese Funktion 0, ansonsten bei einem Fehler -1 zur&uuml;ck.</p>
<a name="t33"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t34"></a><h3 class="t3">9.7.3 Ein Shared-Memory-Segment anbinden (attach) – shmat()<a id="RxxKap09006040002D91F028117" name="RxxKap09006040002D91F028117"></a> 
      <a href="#t2t35"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t33"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999282" name="Xxx999282"></a>Im n&auml;chsten Schritt m&uuml;ssen Sie das erzeugte Shared-Memory-Segment an einen Prozess anbinden. Dies erledigen Sie mit der Funktion <span class="listing">shmat()</span>:<a id="Xxx999284" name="Xxx999284"></a></p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
void *shmat(int shm_id, const void *adresse, int flag);</pre>
<p>Als erstes Argument ben&ouml;tigen Sie wieder die ID des Segmentes, an die Sie den Adressraum anbinden wollen. Mit <span class="listing">adresse</span> geben Sie an, an welcher Adresse im Shared-Memory-Segment Sie »sich anbinden« wollen. Es sei hierbei aus Portabilit&auml;tsgr&uuml;nden empfohlen, dass Sie das dem Kernel &uuml;berlassen und hierf&uuml;r <span class="listing">NULL</span> angeben. Sollten Sie die Adresse dennoch selbst angeben wollen, dann sei hierf&uuml;r die Manual Page empfohlen. Geben Sie als Flag <span class="listing">SHM_RDONLY</span> an, wird das Segment nur zum Lesen angebunden, ansonsten zum Lesen und Schreiben.</p>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<tr>
<td class="tabellentext" bgcolor="#000000">
<p class="BStandard"><b>Hinweis   </b>Nach einem <span class="listing">fork()</span>-Aufruf wird das Shared-Memory-Segment auch an den Kindprozess weitervererbt und kann dabei ebenso verwendet werden. Bei einem <span class="listing">exec()</span>-Aufruf hingegen wei&szlig; der neue Prozess nichts mehr von dem Segment. Und bei einem <span class="listing">exit()</span>-Aufruf werden alle angebundenen Segmente vom Prozess losgel&ouml;st.</p>
</td>
</tr>
</table><br>
<p>Bei Erfolg gibt die Funktion <span class="listing">shmat()</span> die Anfangsadresse des Shared-Memory-Segmentes zur&uuml;ck oder bei einem Fehler -1.</p>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<tr>
<td class="tabellentext" bgcolor="#000000">
<p class="BStandard"><b>Hinweis   </b>Sofern Sie die Funktion <span class="listing">shmat()</span> mit den FreeBSD-Versionen 4.0 bis 5.2 noch vor dem Erscheinungsdatum 04.02.2004 verwenden, haben Sie hierbei eine Sicherheitsl&uuml;cke, die Sie mit einem Patch beheben sollten. </p>
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">
<p class="BStandard">Dabei kann durch einen Fehler in der Verwaltung des Referenzz&auml;hlers weiterhin auf die Segmente zugegriffen werden, obwohl diese l&auml;ngst gel&ouml;st wurden. Ein Angreifer verwendet diese Schwachstelle, um Zugriff auf den Speicher anderer Prozesse zu kommen.</p>
</td>
</tr>
</table><br>
<a name="t34"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t35"></a><h3 class="t3">9.7.4 Ein Shared-Memory-Segment losl&ouml;sen – shmdt()<a id="RxxKap09006040002D91F02817D" name="RxxKap09006040002D91F02817D"></a> 
      <a href="#t2t36"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t34"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999299" name="Xxx999299"></a>Wenn ein Shared-Memory-Segment nicht mehr von einem Prozess ben&ouml;tigt wird, sollte man die Anbindung wieder aufheben. Das Losl&ouml;sen (detach) wird mit der Funktion <span class="listing">shmdt()</span> erledigt:</p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
int shmdt(void *adresse);</pre>
<p>Damit l&ouml;sen Sie die Adresse des Shared-Memory-Segmentes, die Sie als R&uuml;ckgabewert der Funktion <span class="listing">shmat()</span> erhalten haben. Losl&ouml;sen ist &uuml;brigens nicht mit l&ouml;schen (<span class="listing">IPC_RMID</span>) gleichzusetzen, da das Segment ja noch von anderen Prozessen benutzt werden k&ouml;nnte und somit eine L&ouml;schung nicht dem Wunsch des Programmierers entspr&auml;che. Bei Erfolg gibt <span class="listing">shmdt()</span> 0, ansonsten bei einem Fehler -1 zur&uuml;ck.</p>
<a name="t35"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t36"></a><h3 class="t3">9.7.5 Client-Server-Beispiel – Shared Memory<a id="RxxKap09006040002D91F028181" name="RxxKap09006040002D91F028181"></a> 
      <img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"><a href="#t2t35"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p>Im Folgenden soll auch hierzu wieder ein einfaches Client-Server-Beispiel vorgestellt werden. Ein Server richtet ein Shared-Memory-Segment ein und wartet auf eine Nachricht von einem Clientprozess, der in dieses Shared-Memory-Segment etwas schreibt, und gibt diese Nachricht aus. Der Clientprozess wird mit der ID des Shared-Memory-Segments gestartet, das der Server erzeugt hat. Um es einfach zu halten, wird eine einfache Zeichenkette dazu verwendet. Zus&auml;tzlich verwenden die Prozesse Semaphore zum Sperren eines kritischen Codebereichs – weshalb hierf&uuml;r eine eigene Headerdatei mit den Funktionen der Semaphoren verwendet wird. In dieser Headerdatei wird des Weiteren die Funktion <span class="listing">signal()</span> mit dem neuen Signalkonzept definiert, die zur Behandlung ben&ouml;tigt wird, wenn der Server mit <span class="listing">SIGINT</span> unterbrochen wird.</p>
<p>Zuerst die gemeinsame Headerdatei:</p>
<pre><a id="Xxx999306" name="Xxx999306"></a>/* shm_header.h */
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/sem.h&gt;
#include &lt;sys/shm.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;string.h&gt;
#include &lt;signal.h&gt;
#define SHMDATASIZE 1024
#define BUFFERSIZE (SHMDATASIZE - sizeof(int))
#define SN_EMPTY 0
#define SN_FULL  1
/* ---------- Bei BSD-UNIXen auskommentieren ------------ */
#if defined(__GNU_LIBRARY__) &amp;&amp; !defined(_SEM_SEMUN_UNDEFINED)
/* union semun is defined by including &lt;sys/sem.h&gt; */
#else
/* according to X/OPEN we have to define it ourselves */
   union semun {
     int val;                 /* Werte f&uuml;r  SETVAL        */
     struct semid_ds *buf;    /* Puffer IPC_STAT, IPC_SET */
     unsigned short *array;   /* Array f&uuml;r GETALL, SETALL */
                              /* Linux specific part:     */
     struct seminfo *__buf;   /* Puffer f&uuml;r IPC_INFO      */
       };
#endif
/* -------------------------------------------------------- */
static void locksem   (int semid, int semnum);
static void unlocksem (int semid, int semnum);
static void waitzero  (int semid, int semnum);
static int safesemget (key_t key, int nsems, int semflg);
static int safesemctl (int semid, int semnum, 
                       int cmd, union semun arg);
static int safesemop  (int semid, struct sembuf *sops,
                       unsigned nsops);
static int DeleteSemid = 0;
static int DeleteShmid = 0;
static void locksem (int semid, int semnum) {
   struct sembuf sb;
   sb.sem_num = semnum;
   sb.sem_op = -1;
   sb.sem_flg = SEM_UNDO;
   safesemop (semid, &amp;sb, 1);
   return;
}
static void unlocksem (int semid, int semnum) {
   struct sembuf sb;
   sb.sem_num = semnum;
   sb.sem_op = 1;
   sb.sem_flg = SEM_UNDO;
   safesemop (semid, &amp;sb, 1);
}
static void waitzero (int semid, int semnum) {
   struct sembuf sb;
   sb.sem_num = semnum;
   sb.sem_op = 0;
   sb.sem_flg = 0;   
   safesemop (semid, &amp;sb, 1);
   return;
}
static int safesemget (key_t key, int nsems, int semflg) {
   int retval;
   retval = semget (key, nsems, semflg);
   if (retval == -1)
      printf ("Semaphor-Schl&uuml;ssel %d, nsems %d konnte"
              " nicht erstellt werden", key, nsems);
   return retval;
}
static int 
safesemctl (int semid, int semnum, int cmd, union semun arg) {
   int retval;
   retval = semctl (semid, semnum, cmd, arg);
   if (retval == -1)
      printf ("Fehler: Semaphor mit ID %d, semnum %d, "
              "Kommando %d\n", semid, semnum, cmd);
   return retval;
}
static int
safesemop (int semid, struct sembuf *sops, unsigned nsops) {
   int retval;
   retval = semop (semid, sops, nsops);
   if (retval == -1)
      printf ("Fehler: Semaphor mit ID %d (%d Operation)\n",
               semid, nsops);
   return retval;
}
typedef void (*sighandler_t)(int);
static sighandler_t
my_signal(int sig_nr, sighandler_t signalhandler) {
   struct sigaction neu_sig, alt_sig;
   neu_sig.sa_handler = signalhandler;
   sigemptyset (&amp;neu_sig.sa_mask);
   neu_sig.sa_flags = SA_RESTART;
   if (sigaction (sig_nr, &amp;neu_sig, &amp;alt_sig) &lt; 0)
      return SIG_ERR;
   return alt_sig.sa_handler;
}</pre>
<p>Jetzt zur Server-Implementierung:</p>
<pre><a id="Xxx999309" name="Xxx999309"></a>/* server_shm.c */
#include "shm_header.h"
static void delete (void) {
   int res;
   printf ("\nServer wird beendet - L&ouml;sche Semaphor %d.\n",
            DeleteSemid);
   if (semctl (DeleteSemid, 0, IPC_RMID, 0) == -1) {
      printf ("Fehler beim L&ouml;schen des Semaphors.\n");
   }
   /* Wenn Serverprozess beendet wird - */
   /* Segment automatisch l&ouml;schen       */
   res = shmctl (DeleteShmid, IPC_RMID, NULL);
   if (res == -1)
      printf ("Fehler bei shmctl() shmid %d, Kommando %d\n",
          DeleteShmid, IPC_RMID);   
   return;
}
static void sigdelete (int signum) {
   exit(EXIT_FAILURE);
}
static void server (void) {
   union semun sunion;
   int semid, shmid;
   int res;
   void *shmdata;
   char *buffer;
   /* Ein Semaphor erstellen */
   semid = safesemget (IPC_PRIVATE, 2, SHM_R | SHM_W);
   DeleteSemid = semid;
   /* Semaphor beim Beenden entfernen */
   atexit (&amp;delete);
   /* Signalhandler einrichten */
   my_signal (SIGINT, &amp;sigdelete);
   /* Semaphor initialisieren */
   sunion.val = 1;
   safesemctl (semid, SN_EMPTY, SETVAL, sunion);
   sunion.val = 0;
   safesemctl (semid, SN_FULL, SETVAL, sunion);
   /* Ein Shared-Memory-Segment einrichten */
   shmid = shmget (IPC_PRIVATE, SHMDATASIZE,
             IPC_CREAT | SHM_R | SHM_W);
   if (shmid == -1)
      printf ("Fehler bei key %d, mit der Gr&ouml;&szlig;e %d\n",
               IPC_PRIVATE, SHMDATASIZE);
               
    DeleteShmid = shmid;
   /* Shared-Memory-Segment anbinden */
   shmdata = shmat (shmid, NULL, 0);
   if (shmdata == (void *) -1)
      printf ("Fehler bei shmat(): shmid %d\n", shmid);
   /* Kennung am Anfang des Segments schreiben */
   *(int *) shmdata = semid;
   buffer = shmdata + sizeof (int);
   printf ("Server l&auml;uft mit Shared-Memory-ID %d\n", shmid);
   while (1) {
      printf ("Warte ...");
      fflush (stdout);
      /* Sperren und Warten */
      locksem (semid, SN_FULL);
      printf ("\n... fertig.\n");
        /* Ein Client hat etwas geschrieben */
      printf ("Nachricht erhalten: %s\n", buffer);
      /* Sperre aufheben */
      unlocksem (semid, SN_EMPTY);
   }
   return;
}
int main (int argc, char **argv) {
   server ();
   printf("--- Server-Ende ---\n");
   return EXIT_SUCCESS;
}</pre>
<p>Als Letztes die Client-Implementierung:</p>
<pre><a id="Xxx999312" name="Xxx999312"></a>/* client_shm.c */
#include "shm_header.h"
static void clientwrite (int shmid, int semid, char *buffer) {
   printf ("Warte ...");
   fflush (stdout);
   /* Sperre setzen - Client will schreiben */
   locksem (semid, SN_EMPTY);
   printf ("\n... fertig\n");
   printf ("Eingabe machen: ");
   fgets (buffer, BUFFERSIZE, stdin);
   unlocksem (semid, SN_FULL);
   return;
}
static void client (int shmid) {
   int semid;
   void *shmdata;
   char *buffer;
   /* Shared-Memory-Verbindung zu Server */
   shmdata = shmat (shmid, NULL, 0);
   if (shmdata == (void *) -1) {
      printf ("Fehler bei shmat(): shmid %d\n", shmid);
      return;
   }
   semid = *(int *) shmdata;
   buffer = shmdata + sizeof (int);
   printf("Client: Shared-Memory-ID: %d, Semaphor-ID: %d\n",
            shmid, semid);
   while (1) {
      char input[3];
      printf ("\n\nMenu\n1. Eine Nachricht verschicken\n");
      printf ("2. Client-Ende\n");
      fgets (input, sizeof (input), stdin);
      switch (input[0]) {
      case '1':
         clientwrite (shmid, semid, buffer);
         break;
      case '2':
         exit (EXIT_FAILURE);
         break;
      }
   }
   return;
}
int main (int argc, char **argv) {
   if (argc &lt; 2) {
      printf ("Aufruf: %s Shared-Memory-ID\n", *argv);
   }
   else {
      client (atoi (argv[1]));
   }
   return EXIT_SUCCESS;
}</pre>
<p>Das Programm bei der Ausf&uuml;hrung:</p>
<pre>$ gcc -o server_shm server_shm.c
$ gcc -o client_shm client_shm.c
$./server_shm 
Server l&auml;uft mit Shared-Memory-ID 360939526
Warte ...
---[andere Konsole bspw. tty1]---
$./client_shm 360939526
Client: Shared-Memory-ID: 360939526, Semaphor-ID: 12345
Menu
1. Eine Nachricht verschicken
2. Client-Ende
1
Warte ...
... fertig
Eingabe machen: Hallo, das geht durch den gemeinsamen Speicher
Menu
1. Eine Nachricht verschicken
2. Client-Ende
---[beim Server]---
$./server_shm
Server l&auml;uft mit Shared-Memory-ID 360939526
Warte ...
... fertig.
Nachricht erhalten: Hallo, das geht durch den gemeinsamen Speicher
Warte ...
---[andere Konsole bspw. tty2]---
$./client_shm 360939526
Client: Shared-Memory-ID: 360939526, SemaphorID: 12345
Menu
1. Eine Nachricht verschicken
2. Client-Ende
1
Warte ...
... fertig
Eingabe machen: Eine weitere Nachricht
Menu
1. Eine Nachricht verschicken
2. Client-Ende
---[beim Server]---
$./server_shm
Server l&auml;uft mit Shared-Memory-ID 360939526
Warte ...
... fertig.
Nachricht erhalten: Hallo, das geht durch den gemeinsamen Speicher
Warte ...
... fertig.
Nachricht erhalten: Eine weitere Nachricht
Warte ...
STRG+C
Server wird beendet - L&ouml;sche Semaphor 12345</pre>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap09-005.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a class="navnav" href="#">&lt;top&gt;</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap10-000.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
</td>
<td width="10" valign="top">&nbsp;&nbsp;</td>
<td width="160" valign="top">
    <table border="0" cellpadding="0" cellspacing="0" width="160">
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">
                            &nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs">
                            <strong>Zum Katalog</strong></a>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2">
                            <img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><a href="https://www.rheinwerk-verlag.de/linux-unix-programmierung_1137/?GPP=oplup">
                                        <img src="common/749.gif"  border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-UNIX-Programmierung" title="Zum Katalog: Linux-UNIX-Programmierung">
                                        <br /><strong>Linux-UNIX-<br />Programmierung</strong><br /><img src="common/pfeil_rechts5.gif" border="0" alt="">bestellen</a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Ihre Meinung?</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td>Wie hat Ihnen das &lt;openbook&gt; gefallen?<br /><a href="https://www.rheinwerk-verlag.de/feedback/"><img src="common/pfeil_rechts5.gif" border="0" alt="">Ihre Meinung</a>
                                    <br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">&nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs"><strong>Buchtipps</strong></a></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-server_3685/?GPP=oplup">
                        <img src="common/3020.gif" width="78" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Server" title="Zum Katalog: Linux-Server"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-Server</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/das-komplettpaket-lpic-1-lpic-2_3782/?GPP=oplup">
                        <img src="common/3529.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2" title="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2"><br /><br /><br /><br /><br /><br /><br />&nbsp;Das Komplettpaket<br />&nbsp;LPIC-1 &amp; LPIC-2</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-hochverfugbarkeit_3420/?GPP=oplup">
                        <img src="common/2542.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Hochverfügbarkeit" title="Zum Katalog: Linux-Hochverfügbarkeit"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-<br />&nbsp;Hochverfügbarkeit</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/shell-programmierung_3345/?GPP=oplup">
                        <img src="common/2310.gif" width="69" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Shell-Programmierung" title="Zum Katalog: Shell-Programmierung"><br /><br /><br /><br /><br /><br /><br />&nbsp;Shell-<br />&nbsp;Programmierung</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux_3436/?GPP=oplup">
                        <img src="common/2591.gif" width="79" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux Handbuch" title="Zum Katalog: Linux Handbuch"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux Handbuch</a><br /><br /></td>
                    </tr>
                </table></td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Shopping</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><b>Versandkostenfrei</b> bestellen in Deutschland und &Ouml;sterreich<br /><a href="https://www.rheinwerk-verlag.de/hilfe/bestellung_6?GPP=oplup"><img src="common/pfeil_rechts5.gif" border="0" alt="">Info</a><br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</td>
</tr>
</table>
<br /><br />
<hr width="70%" align="center">
<br />
<div align="center">
    <p class="standard">
        <strong>Copyright © Rheinwerk Verlag GmbH 2006</strong>
        <br />F&uuml;r Ihren privaten Gebrauch d&uuml;rfen Sie die Online-Version nat&uuml;rlich 
        ausdrucken. Ansonsten unterliegt das &lt;openbook&gt; denselben Bestimmungen, 
        wie die gebundene Ausgabe: Das Werk einschlie&szlig;lich aller seiner Teile ist 
        urheberrechtlich gesch&uuml;tzt. Alle Rechte vorbehalten einschlie&szlig;lich der 
        Vervielf&auml;ltigung, &Uuml;bersetzung, Mikroverfilmung sowie Einspeicherung und 
        Verarbeitung in elektronischen Systemen.
    </p>
    <br><a href="https://www.rheinwerk-verlag.de/">[Rheinwerk Computing]</a>
    <br /><br />Rheinwerk Verlag GmbH, Rheinwerkallee 4, 53227 Bonn, 
    Tel.: 0228.42150.0, Fax 0228.42150.77, 
    <a href="mailto:service@rheinwerk-verlag.de">service@rheinwerk-verlag.de</a>
</div>
<br /><br />
</body>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap09-006.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:57:26 GMT -->
</html>
