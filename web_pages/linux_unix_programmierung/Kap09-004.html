<html>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap09-004.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:44:42 GMT -->
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Linux-UNIX-Programmierung – 9.5 Semaphore</title>
<meta name="title" content="Linux-UNIX-Programmierung">
<meta name="author" content="J&uuml;rgen Wolf">
<meta name="publisher" content="Rheinwerk Verlag GmbH 2006">
<meta name="copyright" content="Rheinwerk Verlag GmbH 2006">
<meta name="description" content="Linux-UNIX-Programmierung - Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006 – ISBN 3-89842-749-8">
<meta name="audience" content="Alle">
<meta name="robots" content="INDEX,FOLLOW">
<meta http-equiv="content-language" content="de">
<link rel="stylesheet" type="text/css" href="common/rw_open.css">
<link rel="prev" href="Kap09-003.html">
<link rel="next" href="Kap09-005.html"><script type="text/javascript" language="JavaScript"><!--
function OpenWin(url,name,height,width)
{
  var InfoWin = window.open(url,name,"directories=0,height="+height+",width=" + width + ",hotkeys=0,location=0,menubar=0,resizable=1,screenX=150,screenY=10,left=150,top=10,scrollbars=1,status=1,titlebar=0,toolbar=0");
  InfoWin.focus();
}
//--></script></head>
<body vlink="#000099" link="#000099" alink="#000099">
<table width="100%" height="74" border="0" cellpadding="0" cellspacing="0" bgcolor="#00549d">
<tr>
<td height="74" valign="bottom" colspan="2"><a href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"><img src="common/rw_openbook.gif" width="200" height="56" border="0" alt="Rheinwerk Computing < openbook >"></a></td>
<td width="80" height="74">
<a href="https://www.rheinwerk-verlag.de/?GPP=oplup"><img src="common/rw_computing.gif" border="0" alt="Rheinwerk Computing - Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger."></a>
</td>
</tr>
</table><div align="right"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Professionelle B&uuml;cher. Auch f&uuml;r Einsteiger</a></div><br /><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="156" valign="top"><table border="0" cellpadding="0" cellspacing="0" width="100%" align="left">
<tr>
<td colspan="2" class="nav1" align="left" valign="top" height="150">
<table class="tbl1" width="150" border="0" cellpadding="3" cellspacing="0">
<tr>
<td class="tbl2" height="25"><A class="nav" href="index-2.html">Inhaltsverzeichnis</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00a-000.html#Xxx999195">Vorwort des Autors</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap00b-000.html#Xxx999195">Vorwort der Fachgutachter</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap01-000.html#Xxx999235">1 Einf&uuml;hrung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap02-000.html#Xxx999234">2 E/A-Funktionen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap03-000.html#Xxx999234">3 Attribute von Dateien und Verzeichnissen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap04-000.html#Xxx999234">4 Zugriff auf Systeminformationen</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap05-000.html#Xxx999234">5 Devices – eine einfache Verbindung zur Hardware</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap06-000.html#Xxx999234">6 System- und Benutzerdateien</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap07-000.html#Xxx999234">7 D&auml;monen, Zombies und Prozesse</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap08-000.html#Xxx999235">8 Signale</A></td>
</tr>
<tr>
<td><A class="navnavh" href="Kap09-000.html#Xxx999235">9 IPC – Interprozesskommunikation</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap10-000.html#Xxx999234">10 Threads</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap11-000.html#Xxx999235">11 Netzwerkprogrammierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap12-000.html#Xxx999236">12 MySQL und PostgreSQL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap13-000.html#Xxx999235">13 Terminal E/A und Benutzerschnittstellen f&uuml;r die Konsole</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap14-000.html#Xxx999235">14 Xlib – X Window-Programmierung</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap15-000.html#Xxx999235">15 GTK+</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap16-000.html#Xxx999235">16 SDL</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap17-000.html#Xxx999247">17 Werkzeuge f&uuml;r Programmierer</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18A-000.html#Xxx999248">A Sicherheit unter Linux</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18B-000.html#Xxx999245">B Funktionsreferenz</A></td>
</tr>
<tr>
<td><A class="navnav" href="Kap18C-000.html#Xxx999245">C Inhalt der Buch-CD</A></td>
</tr>
<tr>
<td><A class="navnav" href="stichwort.html#Xxx537584">Index</A></td>
</tr>
<tr><td><br /><!--<a class="navnav" href="http://download.galileo-press.de/openbook/lup/galileocomputing_linux_unix_programmierung.zip"><strong>Download:</strong><br />- ZIP, ca. 4,3 MB</a></td></tr>
<tr><td><a class="navnav" href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup">Buch bestellen</a></td></tr>
<tr><td>--><a class="navnav" href="https://www.rheinwerk-verlag.de/feedback/">Ihre Meinung?</a><br /><br /></td></tr>
</table></td>
</tr>

</table>
</td>
<td width="10"><img src="common/spacer10.gif" width="10" height="10"></td>
<td width="85%" valign="top" align="center">
<div align="center">
<table width="98%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap09-003.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navnav">Rheinwerk Computing /</a><a class="navnav" href="https://www.rheinwerk-verlag.de/openbook/?GPP=oplup"> &lt;openbook&gt; /</a> <a href="index-2.html" class="navnav"> Linux-UNIX-Programmierung</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap09-005.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" valign="top">
<table width="100%" border="0" cellpadding="10" cellspacing="0" class="box">
<tr>
<td colspan="2"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup" class="buchtitel">Linux-UNIX-Programmierung</a><span class="autor"> von J&uuml;rgen Wolf</span><br><span class="untertitel">Das umfassende Handbuch – 2., aktualisierte und erweiterte Auflage 2006</span></td>
</tr>
<tr>
<td valign="top" width="90"><a href="https://www.rheinwerk-verlag.de/1137/?GPP=oplup"><img src="common/9783898427494.gif" border="0" alt="Buch: Linux-UNIX-Programmierung" title="Buch: Linux-UNIX-Programmierung" align="left"><br /><br /><span class="autor"><strong>Linux-UNIX-Programmierung</strong><br />1216 S., mit CD, 49,90 Euro<br />Rheinwerk Computing<br />ISBN 3-89842-749-8</span></a></a></td>
<td width="80%">
<table border="0">
<tr>
<td valign="baseline"><img src="common/pfeil_u.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="3" class="kap"><b>Kapitel <a href="Kap09-000.html#RxxKap09000040002B71F02D100">9 IPC – Interprozesskommunikation</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-000.html#RxxKap09000040002B71F02D10B">9.1 Unterschiedliche Interprozesskommunikations-Techniken im &Uuml;berblick</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D10D">9.1.1 (Namenlose) Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D117">9.1.2 Benannte Pipes (FIFO-Pipes)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D183">9.1.3 Message Queue (Nachrichtenspeicher)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D187">9.1.4 Semaphore</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D18A">9.1.5 Shared Memory (gemeinsamer Speicher)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D18D">9.1.6 STREAMS</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D195">9.1.7 Sockets</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D197">9.1.8 Lock Files (Sperrdateien)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-000.html#RxxKap09000040002B71F02D19A">9.1.9 Dateisperren (Record Locking)</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-001.html#RxxKap09001040002D41F046100">9.2 Gr&uuml;nde f&uuml;r IPC</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-002.html#RxxKap09002040002D51F049100">9.3 Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049104">9.3.1 Eigenschaften von Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049108">9.3.2 Pipes einrichten – pipe()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049182">9.3.3 Eigenschaften von elementaren E/A-Funktionen bei Pipes</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049188">9.3.4 Standard-E/A-Funktionen mit pipe</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F049192">9.3.5 Pipes in einen anderen Prozess umleiten</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F04919A">9.3.6 Filterprogramm erstellen mithilfe einer Pipe</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491A6">9.3.7 Einrichten einer Pipe zu einem anderen Prozess – popen()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491B8">9.3.8 Mail versenden mit Pipes und Sendmail</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491C2">9.3.9 Drucken &uuml;ber eine Pipe mit lpr</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-002.html#RxxKap09002040002D51F0491D5">9.3.10 Benannte Pipes – FIFOs</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-003.html#RxxKap09003040002D61F02A100">9.4 System-V-Interprozesskommunikation</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A102">9.4.1 Gemeinsamkeiten der SysV-Mechanismen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A10D">9.4.2 Ein Objekt einrichten, eine Verbindung herstellen und das Objekt wieder l&ouml;schen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-003.html#RxxKap09003040002D61F02A111">9.4.3 Datenaustausch zwischen nicht verwandten Prozessen</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a class="navh2" href="#RxxKap09004040002D71F017100">9.5 Semaphore</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09004040002D71F017104">9.5.1 Lebenszyklus eines Semaphors</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09004040002D71F017116">9.5.2 Ein Semaphor &ouml;ffnen oder erstellen – semget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09004040002D71F01717D">9.5.3 Abfragen, &Auml;ndern oder L&ouml;schen der Semaphormenge – semctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09004040002D71F0171A1">9.5.4 Operationen auf Semaphormengen – semop()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a class="navh2" href="#RxxKap09004040002D71F0171B3">9.5.5 Semaphore im Vergleich mit Sperren</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-005.html#RxxKap09005040002D81F03B100">9.6 Message Queues</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B109">9.6.1 Eine Message Queue &ouml;ffnen oder erzeugen – msgget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B111">9.6.2 Nachrichten versenden – msgsnd()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B176">9.6.3 Eine Nachricht empfangen – msgrcv()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-005.html#RxxKap09005040002D81F03B17E">9.6.4 Abfragen, &Auml;ndern oder L&ouml;schen einer Message Queue – msgctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline" colspan="2"><b><a href="Kap09-006.html#RxxKap09006040002D91F028100">9.7 Shared Memory</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-006.html#RxxKap09006040002D91F028102">9.7.1 Ein Shared-Memory-Segment erstellen oder &ouml;ffnen – shmget()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-006.html#RxxKap09006040002D91F02810A">9.7.2 Ein Shared-Memory-Segment abfragen, &auml;ndern oder l&ouml;schen – shmctl()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-006.html#RxxKap09006040002D91F028117">9.7.3 Ein Shared-Memory-Segment anbinden (attach) – shmat()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-006.html#RxxKap09006040002D91F02817D">9.7.4 Ein Shared-Memory-Segment losl&ouml;sen – shmdt()</a></b></td>
</tr>
<tr>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"> </td>
<td valign="baseline" width="10"><img src="common/pfeil_rechts5.gif" width="10" height="10" border="0" alt="gp"></td>
<td valign="baseline"><b><T3Verw><a href="Kap09-006.html#RxxKap09006040002D91F028181">9.7.5 Client-Server-Beispiel – Shared Memory</a></b></td>
</tr>
</table><br></td>
</tr>
</table>
<table width="100%" cellpadding="20" cellspacing="0" border="0" bgcolor="#eeeeee">
<tr>
<td>
<a name="t21"></a><a name="t2t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div>
<h2 class="t2">9.5 <a id="RxxKap09259Semaphore" name="RxxKap09259Semaphore"></a>Semapho<a id="RxxKap09004040002D71F017100" name="RxxKap09004040002D71F017100"></a>re 
      <a href="#t2t32"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"></h2>
<p><a id="Xxx999236" name="Xxx999236"></a><a id="Xxx999237" name="Xxx999237"></a><a id="Xxx999238" name="Xxx999238"></a>Um es gleich von vornherein klarzustellen, die Semaphore nach System V haben nichts mit den Kernel-Semaphoren zu tun. Rein theoretisch k&ouml;nnten Sie Semaphore selbst nachbilden. Hierzu w&uuml;rden eine globale Variable und eine Funktion ausreichen. Will man nun einen kritischen Codebereich f&uuml;r andere Prozesse sperren, m&uuml;sste die Funktion die globale Variable auf 0 setzen. Alle anderen Prozesse, die jetzt ebenfalls in diesen kritischen Bereich kommen, m&uuml;ssen nun warten, bis die globale Variable wieder einen positiven Wert bekommt (1). Dies ist nat&uuml;rlich nur rein theoretisch gesehen.</p>
<p>Meistens werden Semaphore bin&auml;rer Natur verwendet (wie eben beschrieben). Das sind Semaphore, die man f&uuml;r gew&ouml;hnlich verwendet, um kritische Ressourcen zu sch&uuml;tzen. Dazu reichen die zwei Zust&auml;nde (bi) 1 und 0 aus. Es lassen sich aber auch allgemeine Semaphore verwenden – die dann allerdings die Werte 0, 1, 2, 3 ... n annehmen k&ouml;nnen. Der h&ouml;chste Wert zeigt dann an, wie viele Prozesse den kritischen Bereich noch verwenden.</p>
<p>In System V sind die Semaphore mittlerweile mehr als nur globale Variablen geworden. Um mit diesen Semaphoren zu arbeiten, steht dem Entwickler ein ganzer Satz an Funktionen zur Verf&uuml;gung. Es ist damit auch m&ouml;glich, nicht nur auf einem, sondern auf einem ganzen Satz von Semaphoren Operationen durchzuf&uuml;hren.</p>
<a name="t31"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t32"></a><h3 class="t3">9.5.1 Lebenszyklus eines Semaphors<a id="RxxKap09004040002D71F017104" name="RxxKap09004040002D71F017104"></a> 
      <a href="#t2t33"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t31"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999243" name="Xxx999243"></a>Der Titel ist ein wenig zweischneidig und soll Ihnen mehr oder weniger den &uuml;blichen Weg bzw. die Verwendung eines Semaphors zeigen. Hier die einzelnen Schritte.</p>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Zuerst wird ein Semaphor erzeugt, oder, falls es existiert, das bereits erzeugte wird ge&ouml;ffnet. Beides geschieht mit der Funktion <span class="listing">semget()<a id="Xxx999246" name="Xxx999246"></a></span>. Ein erzeugtes Semaphor sollte zu Beginn gleich auf einen positiven Wert (1) gesetzt werden – was die Funktion <span class="listing">semctl()<a id="Xxx999247" name="Xxx999247"></a></span> erledigt. F&uuml;r alle anderen Prozesse, die ein bereits erzeugtes Semaphor verwenden, sollte dies unbedingt unterbleiben. Denn w&uuml;rde jeder Prozess das Semaphor auf einen positiven Wert setzen, so w&uuml;rde vielleicht ein Prozess, der auf einen anderen Prozess wartet, der gerade in einem kritischen Codeausschnitt arbeitet, ebenfalls Zugriff auf den kritischen Codeausschnitt bekommen.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Wird jetzt eine Sperre f&uuml;r einen kritischen Codebereich ben&ouml;tigt, wird das Semaphor auf den Wert 0 gesetzt – dies erledigen Sie mit der Funktion <span class="listing">semop()<a id="Xxx999249" name="Xxx999249"></a></span>.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Wurde jetzt ein weiterer Prozess gestartet, der nun ebenfalls auf diesen kritischen Bereich zugreifen will, wird das Semaphor &uuml;berpr&uuml;ft, das f&uuml;r die Synchronisation des Bereichs verantwortlich ist. Ist der Wert des Semaphors positiv, so kann der Prozess auf diesen Bereich zugreifen. Dabei dekrementiert logischerweise der Prozess dieses Semaphor, so dass hier wiederum kein anderer Prozess zugreifen kann. Ist hingegen das Semaphor gleich 0, wartet der Prozess so lange, bis der kritische Codebereich freigegeben wird – genauer, bis der Wert des Semaphors wieder positiv (1) ist.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"> Ist ein Prozess mit dem kritischen Codebereich fertig, muss der Wert des Semaphors wieder auf 1 gesetzt werden, um es den anderen Prozessen zu gestatten, ebenfalls auf diesen Bereich zuzugreifen. Dies wird ebenfalls wieder mit der Funktion <span class="listing">semop()</span> gemacht.</td>
</tr>
</table>
<p>Diesen einfachen Vorgang will ich Ihnen nun anhand eines Listings mit anschlie&szlig;ender Erkl&auml;rung demonstrieren:</p>
<pre><a id="Xxx999253" name="Xxx999253"></a>/* sem.c */
#include &lt;stdio.h&gt;
#include &lt;unistd. h.&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/sem.h&gt;
#define LOCK       -1
#define UNLOCK      1
#define PERM 0666      /* Zugriffsrechte */
#define KEY  123458L     
static struct sembuf semaphore;
static int semid;
static int init_semaphore (void) {
   /* Testen, ob das Semaphor bereits existiert */
   semid = semget (KEY, 0, IPC_PRIVATE);
   if (semid &lt; 0) {
      /* ... existiert noch nicht, also anlegen        */
      /* Alle Zugriffsrechte der Dateikreierungsmaske */
      /* erlauben                                     */
      umask(0);
      semid = semget (KEY, 1, IPC_CREAT | IPC_EXCL | PERM);
      if (semid &lt; 0) {
         printf ("Fehler beim Anlegen des Semaphors ...\n");
         return -1;
      }
      printf ("(angelegt) Semaphor-ID : %d\n", semid);
      /* Semaphor mit 1 initialisieren */
      if (semctl (semid, 0, SETVAL, (int) 1) == -1)
         return -1;
   }
   return 1;
}
static int semaphore_operation (int op) {
   semaphore.sem_op = op;
   semaphore.sem_flg = SEM_UNDO;
   if( semop (semid, &amp;semaphore, 1) == -1) {
      perror(" semop ");
      exit (EXIT_FAILURE);
   }
   return 1;
}
int main (void) {
   int res;
   res = init_semaphore ();
   if (res &lt; 0)
      return EXIT_FAILURE;
   printf ("Vor dem kritischen Codeausschnitt ...\n");
   semaphore_operation ( LOCK );
   /* Kritischer Codeausschnitt */
   printf ("PID %d verwendet Semaphor %d\n",
      getpid(), semid);
   printf ("Im kritischen Codeabschnitt ...\n");
   sleep (10);
   semaphore_operation ( UNLOCK );
   printf ("Nach dem kritischen Codeausschnitt ...\n");
   //semctl (semid, 0, IPC_RMID, 0);
   return EXIT_SUCCESS;
}</pre>
<p>Das Programm bei der Ausf&uuml;hrung:</p>
<pre>tty1 $ gcc -o sem sem.c
tty1 $ ./sem
Semaphor-ID : 1048577
Vor dem kritischen Codeausschnitt ...
PID 3582 verwendet Semaphor 1048577
Im kritischen Codeabschnitt ...
[inzwischen vor Ablauf der 10 Sekunden in eine weitere Konsole]
tty2 $ ./sem
Semaphor-ID : 1048577
Vor dem kritischen Codeausschnitt ...
[Wartet auf Freigabe des Semaphors von PID 3582]
[ inzwischen tty0 ]
Nach dem kritischen Codeausschnitt ...
$ tty1
[Jetzt ist das Semaphor frei f&uuml;r tty1]
PID 3583 verwendet Semaphor 1048577
Im kritischen Codeabschnitt ...
[nach 10 Sek.]
Nach dem kritischen Codeausschnitt ... </pre>
<p>Sie k&ouml;nnen hierzu jetzt beliebig viele Prozesse starten. Es kann aber immer nur ein Prozess in dem kritischen Codebereich zugreifen. Einen Sch&ouml;nheitsfehler hat dieses Beispiel allerdings dann doch noch. Geben Sie in der Kommandozeile Folgendes ein<a id="Xxx999258" name="Xxx999258"></a>:</p>
<pre>$ ipcs
Schl&uuml;ssel shmid      Besitzer Rechte  Bytes  nattch   Status
0x0000000 131074     tot      777   196608    2        dest
0x0000000 1971978243 root     644   110592    2        dest
0x0000000 1975975940 root     644   110592    2        dest
0x0000000 1981513733 root     644   110592    2        dest
----- Semaphorfelder -----
Schl&uuml;ssel  SemID      Besitzer   Rechte     nsems
0x0001e242 1048577    tot        666        1
----- Nachrichtenwarteschlangen -----
Schl&uuml;ssel  msqid      Besitzer   Rechte     used-bytes   messages</pre>
<p>Hier sind momentan nur die Semaphorfelder von Interesse. Das Semaphor bleibt also nach Beendigung aller Prozesse erhalten. Von »Hand« k&ouml;nnen Sie dieses folgenderma&szlig;en entfernen (die ID sei 1048577)<a id="Xxx999261" name="Xxx999261"></a>:</p>
<pre>$ ipcrm -s 1048577</pre>
<p>Das d&uuml;rfte aber bei sehr vielen angelegten Semaphoren ein Problem werden. Die folgende (auskommentierte) Zeile w&uuml;rde diesen Vorgang zwar f&uuml;r Sie &uuml;bernehmen:</p>
<pre>//semctl (semid, 0, IPC_RMID, 0);</pre>
<p>h&auml;tte aber zur Folge, dass nach Beendigung des ersten Prozesses das Semaphor gel&ouml;scht wird, und alle anderen Prozesse h&auml;tten diesbez&uuml;glich kein Semaphor mehr zur Verf&uuml;gung. Daher verwendet man auch hier in der Praxis das Server-Client-Prinzip. Der Server erzeugt ein Semaphor und k&uuml;mmert sich auch wieder darum, dass dies beseitigt wird. Die Clients greifen nur auf dieses eine Semaphor zu. Aber jetzt erst zu den Beschreibungen der einzelnen Funktionen im Listing.</p>
<p>Zuerst ben&ouml;tigen Sie, um ein Semaphor anzulegen, die magische Nummer, die hier einfach mit <span class="listing">123458L</span> definiert wurde. Anhand dieser Nummer werden die Semaphore eindeutig im System identifiziert.</p>
<a name="t32"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t33"></a><h3 class="t3">9.5.2 Ein Semaphor &ouml;ffnen oder erstellen – semget()<a id="RxxKap09004040002D71F017116" name="RxxKap09004040002D71F017116"></a> 
      <a href="#t2t34"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t32"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999268" name="Xxx999268"></a><a id="Xxx999269" name="Xxx999269"></a>Die erste Funktion, die im Listing aufgerufen wurde, war <span class="listing">init_semaphore()</span>. Zuerst wird versucht, mit der Funktion <span class="listing">semget()</span> ein bereits erstelltes Semaphor zu &ouml;ffnen.<a id="Xxx999271" name="Xxx999271"></a></p>
<pre>#include &lt;sys/ipc.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/sem.h&gt;
int semget(key_t key, int n_sems, int flag);</pre>
<p>Als erstes Argument bekommt <span class="listing">semget()</span> die magische Nummer. Das zweite Argument entspricht der Anzahl der Semaphore im Satz, und mit dem letzten Argument k&ouml;nnen die Zugriffsprivilegien vergeben werden. Bei den Flags k&ouml;nnen Sie im Prinzip drei Angaben machen, was ebenso auf die Message Queues und die Shared Memories zutrifft.</p>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_PRIVATE<a id="Xxx999274" name="Xxx999274"></a></span> – &Ouml;ffnen eines privaten Schl&uuml;ssels</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_CREAT<a id="Xxx999276" name="Xxx999276"></a></span> – Damit wird ein noch nicht existierender Schl&uuml;ssel erzeugt.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> IPC_EXCL<a id="Xxx999278" name="Xxx999278"></a></span> – Dieses Flag wird in der Regel mit dem bitweisen ODER-Operator hinter <span class="listing">IPC_CREAT</span> angef&uuml;gt. Damit gehen Sie sicher, dass wirklich ein neues Objekt (Semaphor) angelegt wird und nicht ein bereits existierendes mit derselben Kennung. Existiert bereits eine Kennung, bricht die entsprechende Funktion – hier <span class="listing">semget()</span> – mit einem Fehler ab (<span class="listing">errno</span> <span class="listing">==</span> <span class="listing">EEXIST</span>).</td>
</tr>
</table>
<p>Beim ersten <span class="listing">semget()</span>-Aufruf geben Sie als erstes Argument den magischen Schl&uuml;ssel an, als zweites Argument 0, was bedeutet, dass Sie eine bereits existierende Semaphormenge &ouml;ffnen wollen. Als letztes Argument geben Sie <span class="listing">IPC_PRIVATE</span> an – also das &Ouml;ffnen eines bereits existierenden Schl&uuml;ssels. Bei erfolgreichem Funktionsaufruf gibt <span class="listing">semget()</span> die Semaphor-ID zur&uuml;ck, die Sie in der Konsole mit dem Tool ipcs ermitteln k&ouml;nnen. Schl&auml;gt die Funktion hingegen fehl, was beim ersten Aufruf der Fall sein sollte, so gibt <span class="listing">semget()</span> -1 zur&uuml;ck. Somit springt das Programmbeispiel mit seiner Ausf&uuml;hrung in die <span class="listing">if</span>-Verzweigung.</p>
<p>Darin wird nun versucht, eine neue Semaphormenge zu erstellen:</p>
<pre>semid = semget (KEY, 1, IPC_CREAT | IPC_EXCL | PERM);</pre>
<p>Auch hier wird als erstes Argument die magische Kennung &uuml;bergeben, als zweites Argument die Anzahl der Semaphormenge (1). Und zu guter Letzt die Flags <span class="listing">IPC_CREAT</span>, <span class="listing">IPC_EXCL</span> und, sehr wichtig, die Zugriffsrechte auf die Semaphore. Vergessen Sie die Zugriffsrechte oder setzen Sie diese falsch, werden Sie keinen Zugriff auf die Semaphormenge haben. Zur&uuml;ckgegeben wird hier bei Erfolg die Semaphor-ID.</p>
<a name="t33"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t34"></a><h3 class="t3">9.5.3 Abfragen, &Auml;ndern oder L&ouml;schen der Semaphormenge – semctl()<a id="RxxKap09004040002D71F01717D" name="RxxKap09004040002D71F01717D"></a> 
      <a href="#t2t35"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t33"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999285" name="Xxx999285"></a><a id="Xxx999286" name="Xxx999286"></a><a id="Xxx999287" name="Xxx999287"></a>Im n&auml;chsten Schritt setzen Sie den Wert der Semaphorvariablen auf den Wert 1. Dieser Vorgang ist ebenfalls von Bedeutung. W&uuml;rden Sie die Semaphore gleich zu Beginn auf -1 setzen, dann m&uuml;ssen dies die Clientprogramme bzw. das Programm, das auf die Semaphormenge zugreifen will, ebenso ber&uuml;cksichtigen. Gew&ouml;hnlich setzt man den Wert allerdings auf 1. Ein negatives Setzen der Semaphorvariablen zu Beginn entspricht etwa dem Sinn bei einer Bahnschranke, die nur &ouml;ffnet, wenn ein Auto durchfahren will, was ja gew&ouml;hnlich umgekehrt ist.</p>
<p>Das Setzen, aber auch Abfragen oder L&ouml;schen einer Semaphormenge l&auml;sst sich alles mit der Funktion <span class="listing">semctl()</span> realisieren:<a id="Xxx999290" name="Xxx999290"></a></p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/sem.h&gt;
int semctl(int semphoren_ID, int sem_num,
           int kommando, union semun arg);</pre>
<p>Als erstes Argument legen Sie die Semaphore fest, worauf sich <span class="listing">semctl()</span> beziehen soll. Die ID dazu haben Sie als R&uuml;ckgabewert der Funktion <span class="listing">semget()</span> erhalten. Mit dem zweiten Argument spezifizieren Sie einen bestimmten Semaphorwert aus der Menge. <span class="listing">sem_num</span> ist auch bei einigen der <span class="listing">kommando</span>-Angaben von Bedeutung. Bevor auf die einzelnen Kommandos und deren Bedeutung eingegangen wird, zuerst noch die <span class="listing">union</span> <span class="listing">semun</span>, die wie folgt definiert ist:</p>
<pre>#if defined(__GNU_LIBRARY__) &amp;&amp; !defined(_SEM_SEMUN_UNDEFINED)
/* union semun is defined by including &lt;sys/sem.h&gt; */
#else
/* according to X/OPEN we have to define it ourselves */
   union semun {
     int val;                 /* Werte f&uuml;r  SETVAL        */
     struct semid_ds *buf;    /* Puffer IPC_STAT, IPC_SET */
     unsigned short *array;   /* Array f&uuml;r GETALL, SETALL */
                              /* Linux specific part:     */
     struct seminfo *__buf;   /* Puffer f&uuml;r IPC_INFO      */
       };
#endif</pre>
<p>Jetzt zu den einzelnen g&auml;ngigen Kommandos, die als drittes Argument angegeben werden k&ouml;nnen, und deren Bedeutung. F&uuml;r mehr Details sollten Sie allerdings die Manual Page lesen, da eine ausf&uuml;hrlichere Erkl&auml;rung weit &uuml;ber den Rahmen des (ohnehin schon umfangreichen) Kapitels hinausgehen w&uuml;rde.</p>
<br><table width="100%" border="0" cellspacing="1" cellpadding="3">
<caption class="tabunter">
<p><span class="tabunter"><b>Tabelle 9.1   
    </b>Kommandoangaben f&uuml;r die Funktion semctl()</span></p>
</caption>
<tr>
<td class="tabellenkopf" bgcolor="#000000"><b>Kommando</b>
</td>
<td class="tabellenkopf" bgcolor="#000000"><b>Bedeutung</b>
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">IPC_STAT<a id="Xxx999301" name="Xxx999301"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Hiermit kann die Struktur semid_ds angefragt werden. Der Inhalt befindet sich anschlie&szlig;end in der Adresse von buf.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">IPC_SET<a id="Xxx999306" name="Xxx999306"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Hiermit k&ouml;nnen Eigent&uuml;mer und die Zugriffsrechte gesetzt werden.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">IPC_RMID<a id="Xxx999311" name="Xxx999311"></a>
</td>
<td class="tabellentext" bgcolor="#000000">L&ouml;schen einer Semaphormenge
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">GETVAL<a id="Xxx999316" name="Xxx999316"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Hiermit fragen Sie den Wert der Semaphorvariablen ab.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">SETVAL<a id="Xxx999321" name="Xxx999321"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Hiermit k&ouml;nnen Sie den Wert der Semaphorvariablen setzen.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">GETPID<a id="Xxx999326" name="Xxx999326"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Gibt die PID des Prozesses zur&uuml;ck, der zuletzt auf die Semaphorvariablen zugegriffen hat.
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">GETNCNT<a id="Xxx999331" name="Xxx999331"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Abfragen der Prozesse, die warten, bis die Semaphorvariable gr&ouml;&szlig;er als 0 wird
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">GETZCNT<a id="Xxx999336" name="Xxx999336"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Abfragen der Prozesse, die warten, bis die Semaphorvariable gleich 0 ist
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">GETALL<a id="Xxx999341" name="Xxx999341"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Abfragen der Werte aller Semaphorvariablen
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">SETALL<a id="Xxx999346" name="Xxx999346"></a>
</td>
<td class="tabellentext" bgcolor="#000000">Setzen aller Semaphorvariablen
</td>
</tr>
<tr>
<td class="tabellentext" bgcolor="#000000">IPC_INFO<a id="Xxx999351" name="Xxx999351"></a>
</td>
<td class="tabellentext" bgcolor="#000000">(nur Linux) Damit lassen sich Informationen zur entsprechenden Semaphor erfragen.
</td>
</tr>
</table><br>
<p>Der R&uuml;ckgabewert der Funktion <span class="listing">semctl()</span> ist entweder bei Erfolg 0 oder, wurde eines der <span class="listing">GET..</span>-Kommandos verwendet, dann eben ein entsprechender Wert. Bei einem Fehler gibt <span class="listing">semctl()</span>-1 zur&uuml;ck.</p>
<p>Somit h&auml;tten Sie die Semaphore f&uuml;r den eigentlichen Arbeitsvorgang eingerichtet; wobei der weitere Vorgang keine B&auml;ume mehr ausrei&szlig;en d&uuml;rfte.</p>
<a name="t34"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t35"></a><h3 class="t3">9.5.4 Operationen auf Semaphormengen – semop()<a id="RxxKap09004040002D71F0171A1" name="RxxKap09004040002D71F0171A1"></a> 
      <a href="#t2t36"><img src="common/down.gif" width="15" height="15" border="0" alt="down"></a><a href="#t2t34"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999366" name="Xxx999366"></a>Eine Operation k&ouml;nnen Sie mit der Funktion <span class="listing">semop()</span>durchf&uuml;hren – wobei mit durchf&uuml;hren das Ver&auml;ndern der Semaphorvariablen gemeint ist.<a id="Xxx999368" name="Xxx999368"></a></p>
<pre>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/sem.h&gt;
int semop(int semid, struct sembuf sem_array[], size_t n_op);</pre>
<p>Mit dem ersten Argument legen Sie wieder fest, auf welcher Semaphormenge die Operationen mit der Funktion <span class="listing">semop()</span> durchgef&uuml;hrt werden sollen. <span class="listing">sem_array</span> ist eine Adresse eines Arrays von Semaphoroperationen. Folgende Elemente sind in dieser Struktur enthalten:<a id="Xxx999371" name="Xxx999371"></a></p>
<pre>struct sembuf {
   unsigned short sem_num;  /* Semaphornummer der Menge  */
   short sem_op;            /* Semaphoroperation         */
   short sem_flg;           /* Flags: IPC_NOWAIT,SEM_UNDO  */
  }      </pre>
<p>Mit dem dritten Argument von <span class="listing">semop()</span> geben Sie die Anzahl der Elemente im Array <span class="listing">sem_array</span> an, was durchaus mehr als, wie hier im Beispiel demonstriert, ein Element sein kann.</p>
<p>F&uuml;r die Angabe von <span class="listing">sem_op</span> in der Struktur <span class="listing">sembuf</span> sind folgende drei F&auml;lle zu unterscheiden:</p>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> sem_op</span> <span class="listing">&gt;</span> <span class="listing">0</span> – Ist <span class="listing">sem_op</span> gr&ouml;&szlig;er als 0, also 1, wird die Ressource f&uuml;r alle anderen Prozesse freigegeben.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> sem_op</span> <span class="listing">&lt;</span> <span class="listing">0</span> – Ist die Semaphorvariable kleiner als 0, also -1, dann ist der kritische Bereich f&uuml;r alle anderen Prozesse gesperrt. Will jetzt ein weiterer Prozess auf diese Ressource zugreifen, h&auml;ngt dies davon ab, ob <span class="listing">sem_flag</span>, das dritte Element der Struktur <span class="listing">sembuf</span>, auf <span class="listing">IPC_NOWAIT</span> gesetzt wurde. Ist dies der Fall, schl&auml;gt der Funktionsaufruf <span class="listing">semop()</span> fehl. Ist <span class="listing">IPC_NOWAIT</span> nicht gesetzt, wartet der Prozess so lange, bis die Ressource wieder freigegeben wurde.</td>
</tr>
</table>
<table width="100%" border="0">
<tr>
<td valign="baseline" width="16"><img src="common/gp.gif" width="8" height="9" border="0" alt="gp"> 
        </td>
<td valign="top" width="100%" align="left"><span class="listing"> sem_op</span> <span class="listing">==</span> <span class="listing">0</span> – Wird die Semaphorvariable auf 0 gesetzt, kehrt <span class="listing">semop()</span> sofort wieder zur&uuml;ck. Wenn die Semaphorvariable ungleich 0 ist, h&auml;ngt dies wiederum von <span class="listing">sem_flag</span> und <span class="listing">IPC_NOWAIT</span> ab. Ist <span class="listing">IPC_NOWAIT</span> gesetzt, beendet sich <span class="listing">semop()</span> mit einem Fehler. Ansonsten wartet der Prozess so lange, bis entweder <span class="listing">sem_op</span> gleich 0 ist oder das Semaphor gel&ouml;scht wurde.</td>
</tr>
</table>
<p>Hilfreich ist auch das Flag <span class="listing">SEM_UNDO<a id="Xxx999378" name="Xxx999378"></a></span>. Wird n&auml;mlich ein Prozess vorzeitig beendet, wird damit sichergestellt, dass mithilfe eines undo-Z&auml;hlers das vom Prozess gesetzte Semaphor wieder zur&uuml;ckgesetzt wird.</p>
<p>Anders als im Beispiel gesehen k&ouml;nnen Sie <span class="listing">sembuf</span> auch wie folgt mit Werten initialisieren:</p>
<pre>struct sembuf semaphore_lock[1]   = { 0, -1, SEM_UNDO };
struct sembuf semaphore_unlock[1] = { 0, 1,  SEM_UNDO };
...
/* Ressource sperren */
semop(semid, &amp;semaphore_lock[0], 1); 
...
/* Ressource freigeben */
semop(semid, &amp;semaphore_unlock[0], 1 );</pre>
<p>Um in diesem Beispiel die Funktion <span class="listing">semaphore_operation()</span> komplett zu machen, sollten Sie noch eine weitere symbolische Konstante 0 als ZERO definieren, womit Sie alle drei M&ouml;glichkeiten der Semaphorvariablen ausgesch&ouml;pft h&auml;tten. Mit</p>
<pre>semaphore_operation ( LOCK );</pre>
<p>sperren Sie einen kritischen Bereich. <span class="listing">LOCK</span> ist als -1 definiert. Und mittels</p>
<pre>semaphore_operation ( UNLOCK );</pre>
<p>geben Sie die Ressource wieder frei, da <span class="listing">UNLOCK</span> als 1 definiert wurde.</p>
<a name="t35"></a><br><div align="center"><a href="#top"><img src="common/top.gif" border="0" alt="Rheinwerk Computing"></a></div><a name="t2t36"></a><h3 class="t3">9.5.5 Semaphore im Vergleich mit Sperren<a id="RxxKap09004040002D71F0171B3" name="RxxKap09004040002D71F0171B3"></a> 
      <img src="common/15x15leer.gif" width="15" height="15" border="0" alt="top"><a href="#t2t35"><img src="common/top.gif" width="15" height="15" border="0" alt="top"></a></h3>
<p><a id="Xxx999388" name="Xxx999388"></a>Semaphore sind den Sperren ja nicht un&auml;hnlich, weshalb ein Vergleich hier lohnt. Auf beiden Seiten hat man einen Vorteil. Die Verwendung von Sperren (Record Locking) gestaltet sich wesentlich einfacher. Daf&uuml;r ist der Geschwindigkeitsvorteil ganz klar auf der Seite der Semaphore. Somit bleibt es letztendlich dem Entwickler selbst &uuml;berlassen, wof&uuml;r er sich entscheidet.</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td width="100%" class="start" colspan="1" height="22" align="center">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="20%"><a class="navnav" href="Kap09-003.html"> &lt;&lt; zur&uuml;ck</a></td>
<td width="59%">
<div align="center"><a class="navnav" href="#">&lt;top&gt;</a></div>
</td>
<td align="right" width="20%">
<div align="right"><a class="navnav" href="Kap09-005.html">vor &gt;&gt; </a></div>
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
</td>
<td width="10" valign="top">&nbsp;&nbsp;</td>
<td width="160" valign="top">
    <table border="0" cellpadding="0" cellspacing="0" width="160">
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">
                            &nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs">
                            <strong>Zum Katalog</strong></a>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2">
                            <img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><a href="https://www.rheinwerk-verlag.de/linux-unix-programmierung_1137/?GPP=oplup">
                                        <img src="common/749.gif"  border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-UNIX-Programmierung" title="Zum Katalog: Linux-UNIX-Programmierung">
                                        <br /><strong>Linux-UNIX-<br />Programmierung</strong><br /><img src="common/pfeil_rechts5.gif" border="0" alt="">bestellen</a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Ihre Meinung?</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td>Wie hat Ihnen das &lt;openbook&gt; gefallen?<br /><a href="https://www.rheinwerk-verlag.de/feedback/"><img src="common/pfeil_rechts5.gif" border="0" alt="">Ihre Meinung</a>
                                    <br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2">&nbsp;<a href="https://www.rheinwerk-verlag.de/?GPP=oplup" class="navs"><strong>Buchtipps</strong></a></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-server_3685/?GPP=oplup">
                        <img src="common/3020.gif" width="78" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Server" title="Zum Katalog: Linux-Server"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-Server</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/das-komplettpaket-lpic-1-lpic-2_3782/?GPP=oplup">
                        <img src="common/3529.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2" title="Zum Katalog: Das Komplettpaket LPIC-1 &amp; LPIC-2"><br /><br /><br /><br /><br /><br /><br />&nbsp;Das Komplettpaket<br />&nbsp;LPIC-1 &amp; LPIC-2</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux-hochverfugbarkeit_3420/?GPP=oplup">
                        <img src="common/2542.gif" width="70" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux-Hochverfügbarkeit" title="Zum Katalog: Linux-Hochverfügbarkeit"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux-<br />&nbsp;Hochverfügbarkeit</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/shell-programmierung_3345/?GPP=oplup">
                        <img src="common/2310.gif" width="69" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Shell-Programmierung" title="Zum Katalog: Shell-Programmierung"><br /><br /><br /><br /><br /><br /><br />&nbsp;Shell-<br />&nbsp;Programmierung</a><br /><br /></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td><td valign="top">
                        <a href="https://www.rheinwerk-verlag.de/linux_3436/?GPP=oplup">
                        <img src="common/2591.gif" width="79" height="100" border="0" align="left" hspace="4" vspace="8" alt="Zum Katalog: Linux Handbuch" title="Zum Katalog: Linux Handbuch"><br /><br /><br /><br /><br /><br /><br />&nbsp;Linux Handbuch</a><br /><br /></td>
                    </tr>
                </table></td>
        </tr>
        <tr>
            <td><img src="common/leer.gif" height="2" width="1" border="0" /></td>
        </tr>
        <tr>
            <td>
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tr>
                        <td class="tbl2" height="20" colspan="2"><strong>&nbsp;Shopping</strong></td>
                    </tr>
                    <tr>
                        <td valign="top" class="tbl2" width="2"><img src="common/leer.gif" border="0" height="1" width="1"></td>
                        <td valign="top">
                            <table cellspacing="3">
                                <tr>
                                    <td><b>Versandkostenfrei</b> bestellen in Deutschland und &Ouml;sterreich<br /><a href="https://www.rheinwerk-verlag.de/hilfe/bestellung_6?GPP=oplup"><img src="common/pfeil_rechts5.gif" border="0" alt="">Info</a><br /><br /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</td>
</tr>
</table>
<br /><br />
<hr width="70%" align="center">
<br />
<div align="center">
    <p class="standard">
        <strong>Copyright © Rheinwerk Verlag GmbH 2006</strong>
        <br />F&uuml;r Ihren privaten Gebrauch d&uuml;rfen Sie die Online-Version nat&uuml;rlich 
        ausdrucken. Ansonsten unterliegt das &lt;openbook&gt; denselben Bestimmungen, 
        wie die gebundene Ausgabe: Das Werk einschlie&szlig;lich aller seiner Teile ist 
        urheberrechtlich gesch&uuml;tzt. Alle Rechte vorbehalten einschlie&szlig;lich der 
        Vervielf&auml;ltigung, &Uuml;bersetzung, Mikroverfilmung sowie Einspeicherung und 
        Verarbeitung in elektronischen Systemen.
    </p>
    <br><a href="https://www.rheinwerk-verlag.de/">[Rheinwerk Computing]</a>
    <br /><br />Rheinwerk Verlag GmbH, Rheinwerkallee 4, 53227 Bonn, 
    Tel.: 0228.42150.0, Fax 0228.42150.77, 
    <a href="mailto:service@rheinwerk-verlag.de">service@rheinwerk-verlag.de</a>
</div>
<br /><br />
</body>

<!-- Mirrored from openbook.rheinwerk-verlag.de/linux_unix_programmierung/Kap09-004.htm by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 May 2017 19:44:42 GMT -->
</html>
